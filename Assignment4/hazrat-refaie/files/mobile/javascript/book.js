var bm={installed:!1,isBm:!1,isAdd:!0,isSelect:!1,shiftSpeed:300,init:function(){if(!bm.installed){for(var a in bookData.BM.bmElement);if(void 0!=a)bm.isBm=!0,bm.rasterize.init();bm.installed=!0}},showList:function(){if(bm.isBm)if("hide"==ctrlEngine.state)ctrlEngine.mode="bm",ctrlEngine.display();else if(bm.isEdit=!1,bm.isSelect=!1,"bm"==ctrlEngine.mode)ctrlEngine.hide();else if("toc"==ctrlEngine.mode)ctrlEngine.mode="bm",ctrlEngine.change()},addButton:{action:function(){bm.isAdd?bm.addButton.addBM(pageMediator.getPage()):
onePageBook.installed||zoomBook.installed?(bm.rasterize.remFx(pageMediator.getPage()),bookData.BM.rem(pageMediator.getPage()),bm.addButton.remBM()):twoPageBook.installed&&(0<twoPageBook.currentPage.left&&bookData.page[twoPageBook.currentPage.left].mark&&(bm.rasterize.remFx(twoPageBook.currentPage.left),bookData.BM.rem(twoPageBook.currentPage.left)),twoPageBook.currentPage.right<=bookData.pageCount&&bookData.page[twoPageBook.currentPage.right].mark&&(bm.rasterize.remFx(twoPageBook.currentPage.right),
bookData.BM.rem(twoPageBook.currentPage.right)),bm.addButton.remBM())},addBM:function(a){if(!bm.isBm)bm.isBm=!0,bm.rasterize.imgLoaded||bm.rasterize.init(),buttons.bm.check();test=function(){var b="",b=browser.publisher.isOn?"Bookmark "+a:prompt("Enter bookmark name:","Bookmark "+a);if(""!=b&&null!=b){ctrlEngine.edit.addBM(a,b);bm.isAdd=!1;buttons.addBm.check();if("hide"!=ctrlEngine.state){"bm"!=ctrlEngine.mode?(ctrlEngine.mode="bm",ctrlEngine.change()):"bm"==ctrlEngine.mode&&ctrlEngine.redraw();
for(var b=el.id("MenuBM"),c=0;c<b.childNodes.length;c++)if(b.childNodes[c].getAttribute("page")==a){b=b.childNodes[c];b.setAttribute("select",!0);b.style.background="#bbbbbb";bm.isSelect=!0;break}}bm.rasterize.addFx(a)}a=null};window.setTimeout(test,50)},remBM:function(){bm.isAdd=!0;buttons.addBm.check();for(var a in bookData.BM.bmElement);if(void 0==a)bm.isBm=!1,"hide"!=ctrlEngine.state&&ctrlEngine.hide(),buttons.bm.check();if("hide"!=ctrlEngine.state)"bm"!=ctrlEngine.mode?(ctrlEngine.mode="bm",
ctrlEngine.change()):"bm"==ctrlEngine.mode&&ctrlEngine.redraw()}},rasterize:{timeStep:10,imgLoaded:!1,imgBm:{},imgData:{},width:40,height:85,init:function(){bm.rasterize.imgBm=new Image;bm.rasterize.imgBm.src=null===dir?bookmark_img:STYLES_SRC+"bookmark.png";bm.rasterize.imgLoaded=!0},draw:function(a,b){var c=a.canvas.width,d=0.06*c/40;bm.rasterize.width=(40*d).toFixed();bm.rasterize.height=(85*d).toFixed();d=(60*d).toFixed();bm.rasterize.getImg(a,b,c,d,0);bm.rasterize.drawImg(a,b,c,d,0)},addFx:function(a){var b=
el.id("canvas"+a),c=b.getContext("2d"),d=b.width,b=0.06*d/40;bm.rasterize.width=(40*b).toFixed();bm.rasterize.height=(85*b).toFixed();var e=(60*b).toFixed(),f=(8.5*b).toFixed(),b=null;bm.rasterize.getImg(c,a,d,e,0);var h=0,g=-bm.rasterize.height,b=function(){bm.rasterize.putImg(c,a,d,e,0);bm.rasterize.drawImg(c,a,d,e,g);g=1*g+1*f;0<=g&&(clearInterval(h),a=c=d=e=f=g=h=null)};"android"==device.name()?(bm.rasterize.drawImg(c,a,d,e,0),h=null):h=window.setInterval(b,bm.rasterize.timeStep);b=null},remFx:function(a){var b=
el.id("canvas"+a),c=b.getContext("2d"),d=b.width,b=0.06*d/40;bm.rasterize.width=(40*b).toFixed();bm.rasterize.height=(85*b).toFixed();var e=(60*b).toFixed(),f=(8.5*b).toFixed(),b=null,h=0,g=0,b=function(){bm.rasterize.putImg(c,a,d,e,0);bm.rasterize.drawImg(c,a,d,e,g);g=1*g-1*f;g<-bm.rasterize.height&&(clearInterval(h),bm.rasterize.putImg(c,a,d,e,0),a=c=d=e=f=g=h=null)};"android"==device.name()?(onePageBook.destroyPage(a),onePageBook.drawPage(a),h=null):h=window.setInterval(b,bm.rasterize.timeStep);
b=null},putImg:function(a,b,c,d,e){onePageBook.installed||zoomBook.installed?a.putImageData(bm.rasterize.imgData[b],c-d-bm.rasterize.width,e,bm.rasterize.width,bm.rasterize.height):twoPageBook.installed&&1==1*b%2?a.putImageData(bm.rasterize.imgData[b],c-d-bm.rasterize.width,e,bm.rasterize.width,bm.rasterize.height):a.putImageData(bm.rasterize.imgData[b],d,e,bm.rasterize.width,bm.rasterize.height)},getImg:function(a,b,c,d,e){bm.rasterize.imgData[b]=onePageBook.installed||zoomBook.installed?a.getImageData(c-
d-bm.rasterize.width,e,bm.rasterize.width,bm.rasterize.height):twoPageBook.installed&&1==1*b%2?a.getImageData(c-d-bm.rasterize.width,e,bm.rasterize.width,bm.rasterize.height):a.getImageData(d,e,bm.rasterize.width,bm.rasterize.height)},drawImg:function(a,b,c,d,e){onePageBook.installed||zoomBook.installed?a.drawImage(bm.rasterize.imgBm,c-d-bm.rasterize.width,e,bm.rasterize.width,bm.rasterize.height):twoPageBook.installed&&1==1*b%2?a.drawImage(bm.rasterize.imgBm,c-d-bm.rasterize.width,e,bm.rasterize.width,
bm.rasterize.height):a.drawImage(bm.rasterize.imgBm,d,e,bm.rasterize.width,bm.rasterize.height)}}},bookChoice={getType:function(){return browser.platform.ios?"landscape"===orientationObserver.getOrientation()?"iPad"==device.name()?"two":"one":"portrait"===orientationObserver.getOrientation()?"one":"two":"one"}};"undefined"==typeof XML&&(XML=function(){});XML.ObjTree=function(){return this};XML.ObjTree.VERSION="0.24";XML.ObjTree.prototype.xmlDecl='<?xml version="1.0" encoding="UTF-8" ?>\n';
XML.ObjTree.prototype.attr_prefix="-";XML.ObjTree.prototype.overrideMimeType="text/xml";XML.ObjTree.prototype.parseXML=function(a){var b;if(window.DOMParser){b=new DOMParser;a=b.parseFromString(a,"application/xml");if(!a)return;b=a.documentElement}else if(window.ActiveXObject)b=new ActiveXObject("Microsoft.XMLDOM"),b.async=!1,b.loadXML(a),b=b.documentElement;return!b?void 0:this.parseDOM(b)};
XML.ObjTree.prototype.parseHTTP=function(a,b,c){var d={},e;for(e in b)d[e]=b[e];if(!d.method)d.method="undefined"==typeof d.postBody&&"undefined"==typeof d.postbody&&"undefined"==typeof d.parameters?"get":"post";if(c){d.asynchronous=!0;var f=this,h=d.onComplete;d.onComplete=function(a){var b;a&&a.responseXML&&a.responseXML.documentElement?b=f.parseDOM(a.responseXML.documentElement):a&&a.responseText&&(b=f.parseXML(a.responseText));c(b,a);h&&h(a)}}else d.asynchronous=!1;var g;if("undefined"!=typeof HTTP&&
HTTP.Request){if(d.uri=a,a=new HTTP.Request(d))g=a.transport}else if("undefined"!=typeof Ajax&&Ajax.Request&&(a=new Ajax.Request(a,d)))g=a.transport;if(c)return g;if(g&&g.responseXML&&g.responseXML.documentElement)return this.parseDOM(g.responseXML.documentElement);if(g&&g.responseText)return this.parseXML(g.responseText)};
XML.ObjTree.prototype.parseDOM=function(a){if(a){this.__force_array={};if(this.force_array)for(var b=0;b<this.force_array.length;b++)this.__force_array[this.force_array[b]]=1;b=this.parseElement(a);this.__force_array[a.nodeName]&&(b=[b]);if(11!=a.nodeType){var c={};c[a.nodeName]=b;b=c}return b}};
XML.ObjTree.prototype.parseElement=function(a){if(7!=a.nodeType){if(3==a.nodeType||4==a.nodeType)return null==a.nodeValue.match(/[^\x00-\x20]/)?void 0:a.nodeValue;var b,c={};if(a.attributes&&a.attributes.length){b={};for(var d=0;d<a.attributes.length;d++){var e=a.attributes[d].nodeName;if("string"==typeof e){var f=a.attributes[d].nodeValue;f&&(e=this.attr_prefix+e,"undefined"==typeof c[e]&&(c[e]=0),c[e]++,this.addNode(b,e,c[e],f))}}}if(a.childNodes&&a.childNodes.length){e=!0;b&&(e=!1);for(d=0;d<a.childNodes.length&&
e;d++)f=a.childNodes[d].nodeType,3==f||4==f||(e=!1);if(e){b||(b="");for(d=0;d<a.childNodes.length;d++)b+=a.childNodes[d].nodeValue}else{b||(b={});for(d=0;d<a.childNodes.length;d++)if(e=a.childNodes[d].nodeName,"string"==typeof e&&(f=this.parseElement(a.childNodes[d])))"undefined"==typeof c[e]&&(c[e]=0),c[e]++,this.addNode(b,e,c[e],f)}}return b}};
XML.ObjTree.prototype.addNode=function(a,b,c,d){this.__force_array[b]?(1==c&&(a[b]=[]),a[b][a[b].length]=d):1==c?a[b]=d:2==c?a[b]=[a[b],d]:a[b][a[b].length]=d};XML.ObjTree.prototype.writeXML=function(a){return this.xmlDecl+this.hash_to_xml(null,a)};
XML.ObjTree.prototype.hash_to_xml=function(a,b){var c=[],d=[],e;for(e in b)if(b.hasOwnProperty(e)){var f=b[e];e.charAt(0)!=this.attr_prefix?c[c.length]="undefined"==typeof f||null==f?"<"+e+" />":"object"==typeof f&&f.constructor==Array?this.array_to_xml(e,f):"object"==typeof f?this.hash_to_xml(e,f):this.scalar_to_xml(e,f):d[d.length]=" "+e.substring(1)+'="'+this.xml_escape(f)+'"'}d=d.join("");e=c.join("");"undefined"==typeof a||null==a||(e=0<c.length?e.match(/\n/)?"<"+a+d+">\n"+e+"</"+a+">\n":"<"+
a+d+">"+e+"</"+a+">\n":"<"+a+d+" />\n");return e};XML.ObjTree.prototype.array_to_xml=function(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];c[c.length]="undefined"==typeof e||null==e?"<"+a+" />":"object"==typeof e&&e.constructor==Array?this.array_to_xml(a,e):"object"==typeof e?this.hash_to_xml(a,e):this.scalar_to_xml(a,e)}return c.join("")};XML.ObjTree.prototype.scalar_to_xml=function(a,b){return"#text"==a?this.xml_escape(b):"<"+a+">"+this.xml_escape(b)+"</"+a+">\n"};
XML.ObjTree.prototype.xml_escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};
var bookData={loaded:!1,background:"",load:function(a){function b(a){var c={},d,g=1;if(a.length)for(d in a){d=a[d];c[g]={};if(d.title)c[g].name=d.title["@value"];if(d.pageNumber)c[g].page=d.pageNumber["@value"];if(d.children)c[g].children={},c[g].children.tocElement=b(d.children.tocData);g++}else{c[1]={};if(a.title)c[1].name=a.title["@value"];if(a.pageNumber)c[1].page=a.pageNumber["@value"];if(a.children)c[1].children={},c[1].children.tocElement=b(a.children.tocData)}return c}var c=new XML.ObjTree;
c.attr_prefix="@";a=c.parseDOM(a);a=a["#document"];this.size={};this.size.width=a.Properties.bookProperties.bookWidth?a.Properties.bookProperties.bookWidth["@value"]:600;this.size.height=a.Properties.bookProperties.bookHeight?a.Properties.bookProperties.bookHeight["@value"]:800;bookData.background={};bookData.background.src=a.Properties.bookProperties.bookBG["@src"];bookData.background.scale=a.Properties.bookProperties.bookBG["@scale"];bookData.name=a.Properties.bookProperties.bookName["@value"]?
a.Properties.bookProperties.bookName["@value"]:"";bookData.tocVisible=a.Properties.bookProperties.tocVisible["@value"];bookData.bookmarksVisible=a.Properties.bookProperties.bookmarksVisible["@value"];bookData.slideshowVisible=a.Properties.bookProperties.slideshowVisible["@value"];bookData.searchVisible=!1;bookData.navigationVisible=!0;bookData.TOC={};if(a.Properties.tableOfContent.tocData.children)bookData.TOC.tocElement={},bookData.TOC.tocElement=b(a.Properties.tableOfContent.tocData.children.tocData);
this.page={};c=0;for(itemNum in a.Properties.bookProperties.pages.elements.page){if("links"!=itemNum){c++;if("id"===itemNum){var d=a.Properties.bookProperties.pages.elements.page.id;itemNum=null;itemNum={id:{}};itemNum.id["@value"]=d["@value"];d=null}else itemNum=a.Properties.bookProperties.pages.elements.page[itemNum];bookData.page[c]={};bookData.page[c].width=itemNum.width?itemNum.isWide&&"true"==itemNum.isWide["@value"]?itemNum.width["@value"]/2:itemNum.width["@value"]:itemNum.isWide&&"true"==
itemNum.isWide["@value"]?a.Properties.bookProperties.pages.defaultValue.width["@value"]/2:a.Properties.bookProperties.pages.defaultValue.width["@value"];bookData.page[c].height=itemNum.height?itemNum.height["@value"]:a.Properties.bookProperties.pages.defaultValue.height["@value"];bookData.page[c].proportions=(bookData.page[c].width/bookData.page[c].height-0.001).toFixed(2);bookData.page[c].stub=itemNum.isStub?!0:!1;if(itemNum.isWide&&"true"==itemNum.isWide["@value"]){bookData.page[c+1]={};bookData.page[c+
1].height=bookData.page[c].height;bookData.page[c+1].width=bookData.page[c].width;bookData.page[c+1].stub=bookData.page[c].stub;bookData.page[c+1].proportions=bookData.page[c].proportions;bookData.page[c].wide=!0;bookData.page[c+1].wide=!0;bookData.page[c].src=images.getImagePath(itemNum.id["@value"],"stand",!0,1);bookData.page[c+1].src=images.getImagePath(itemNum.id["@value"],"stand",!0,2);bookData.page[c].srcZoom=images.getImagePath(itemNum.id["@value"],"zoom",!0,1);bookData.page[c+1].srcZoom=images.getImagePath(itemNum.id["@value"],
"zoom",!0,2);if(itemNum.links)bookData.page[c].links={},this.linksImport(itemNum,c);c++}else if(bookData.page[c].src=images.getImagePath(itemNum.id["@value"]),bookData.page[c].srcZoom=images.getImagePath(itemNum.id["@value"],"zoom"),bookData.page[c].wide=!1,itemNum.links)bookData.page[c].links={},this.linksImport(itemNum,c)}bookData.page[c].mark=!1}this.pageCount=c;c=null;bookData.BM={bmElement:{},load:function(){if(!browser.publisher.isOn)for(var a in window.localStorage)if(a.substring(0,bookData.name.length)==
bookData.name)a.substring(bookData.name.length)<=bookData.pageCount?(bookData.BM.bmElement[a.substring(bookData.name.length)]=window.localStorage[a],bookData.page[a.substring(bookData.name.length)].mark=!0):bookData.BM.clear()},add:function(a,b){browser.publisher.isOn||(window.localStorage[bookData.name+a]=b);bookData.BM.bmElement[a]=b;bookData.page[a].mark=!0},change:function(a,b){browser.publisher.isOn||(window.localStorage[bookData.name+a]=b);bookData.BM.bmElement[a]=b},rem:function(a){browser.publisher.isOn||
window.localStorage.removeItem(bookData.name+a);delete bookData.BM.bmElement[a];bookData.page[a].mark=!1},clear:function(){if(!browser.publisher.isOn){for(var a in window.localStorage)a.substring(0,bookData.name.length);a=null;bookData.BM.bmElement={};for(a in bookData.page)bookData.page[a].mark=!1}}};bookData.BM.load();this.size.proportions=(bookData.size.width/bookData.size.height-0.001).toFixed(2);this.loaded=!0},linksImport:function(a,b,c){for(var c=c||"normal",a=a.links.link[0]?a.links.link:
[a.links.link],d=0;d<a.length;d++){bookData.page[b].links[d]=[];"wide"==c?(bookData.page[b+1].links[d]=[],1*a[d].x["@value"]>1*bookData.size.width?(bookData.page[b+1].links[d].x=a[d].x["@value"]-1*bookData.size.width,bookData.page[b].links[d].width=a[d].width["@value"]):1*a[d].x["@value"]<1*bookData.size.width&&1*a[d].x["@value"]+1*a[d].width["@value"]>1*bookData.size.width?(bookData.page[b].links[d].x=a[d].x["@value"],bookData.page[b+1].links[d].x=0,bookData.page[b].links[d].width=1*a[d].width["@value"]-
1*a[d].x["@value"],bookData.page[b+1].links[d].width=1*a[d].x["@value"]+1*a[d].width["@value"]-1*bookData.size.width):(bookData.page[b].links[d].x=a[d].x["@value"],bookData.page[b].links[d].width=a[d].width["@value"]),bookData.page[b].links[d].y=a[d].y["@value"]):(bookData.page[b].links[d].x=a[d].x["@value"],bookData.page[b].links[d].y=a[d].y["@value"],bookData.page[b].links[d].width=a[d].width["@value"]);bookData.page[b].links[d].height=a[d].height["@value"];if(a[d].page["@id"])bookData.page[b].links[d].page=
a[d].page["@id"];if(a[d].urls)if(bookData.page[b].links[d].urls=[],a[d].urls.url[0])for(var e=0;e<a[d].urls.url.length;e++)bookData.page[b].links[d].urls[e]=a[d].urls.url[e].src;else bookData.page[b].links[d].urls[0]=a[d].urls.url["@src"]}}},bookWidthFx={widthChangeL:"none",widthChangeR:"none",widthChangeB:"none",widthStateL:"thin",widthStateR:"fat",twoPageState:"Landscape",shiftL:0,init:function(){if(el.id("bookWidth"))el.id("bookWidth");else{var a=el.add("div");a.id="bookWidth";if(onePageBook.installed)a.style.position=
"absolute",a.style.width=onePageBook.bookWidth+"px",a.style.height=onePageBook.bookHeight+"px",a.style.top=onePageBook.bookTop+"px",a.style.left=onePageBook.bookLeft+"px";else if(twoPageBook.installed)a.style.position="absolute",a.style.width=twoPageBook.bookWidth+"px",a.style.height=twoPageBook.bookHeight+"px",a.style.top=twoPageBook.bookTop+"px",a.style.left=twoPageBook.bookLeft+"px";el.id("mainFrame").appendChild(a)}},destroy:function(){el.del("bookWidth")},checkChange:function(a){var b;if(onePageBook.installed)bookWidthFx.widthStateL=
"thin",bookWidthFx.widthChangeL="none",b=a;else if(twoPageBook.installed){b=a.right;if(6>a.left){if("fat"==bookWidthFx.widthStateL&&"toThin"!=bookWidthFx.widthChangeL)bookWidthFx.widthChangeL="toThin";else if("thin"==bookWidthFx.widthStateL&&"toThin"==bookWidthFx.widthChangeL)bookWidthFx.widthChangeL="none";bookWidthFx.widthStateL="thin";bookWidthFx.shiftL=-9}else{if("thin"==bookWidthFx.widthStateL&&"toFat"!=bookWidthFx.widthChangeL)bookWidthFx.widthChangeL="toFat";else if("fat"==bookWidthFx.widthStateL&&
"toFat"==bookWidthFx.widthChangeL)bookWidthFx.widthChangeL="none";bookWidthFx.widthStateL="fat";bookWidthFx.shiftL=-18}1==a.right?(bookWidthFx.widthChangeB="right"!=bookWidthFx.twoPageState&&"toRight"!=bookWidthFx.widthChangeB?"toRight":"none",bookWidthFx.twoPageState="right"):0==bookData.pageCount%2&&a.left==bookData.pageCount?(bookWidthFx.widthChangeB="left"!=bookWidthFx.twoPageState&&"left"!=bookWidthFx.widthChangeB?"toLeft":"none",bookWidthFx.twoPageState="left"):(bookWidthFx.widthChangeB="Landscape"!=
bookWidthFx.twoPageState&&"toLandscape"!=bookWidthFx.widthChangeB?"toLandscape":"none",bookWidthFx.twoPageState="Landscape")}if(3>bookData.pageCount-b&&onePageBook.installed){if("fat"==bookWidthFx.widthStateR&&"toThin"!=bookWidthFx.widthChangeR)bookWidthFx.widthChangeR="toThin";else if("thin"==bookWidthFx.widthStateR&&"toThin"==bookWidthFx.widthChangeR)bookWidthFx.widthChangeR="none";bookWidthFx.widthStateR="thin"}else if(6>bookData.pageCount-b&&twoPageBook.installed){if("fat"==bookWidthFx.widthStateR&&
"toThin"!=bookWidthFx.widthChangeR)bookWidthFx.widthChangeR="toThin";else if("thin"==bookWidthFx.widthStateR&&"toThin"==bookWidthFx.widthChangeR)bookWidthFx.widthChangeR="none";bookWidthFx.widthStateR="thin"}else{if("thin"==bookWidthFx.widthStateR&&"toFat"!=bookWidthFx.widthChangeR)bookWidthFx.widthChangeR="toFat";else if("fat"==bookWidthFx.widthStateR&&"toFat"==bookWidthFx.widthChangeR)bookWidthFx.widthChangeR="none";bookWidthFx.widthStateR="fat"}onePageBook.installed?window.setTimeout(bookWidthFx.changeState,
onePageBook.flipSpeed):twoPageBook.installed&&("right"==bookWidthFx.twoPageState?bookWidthFx.changeState():"left"==bookWidthFx.twoPageState?bookWidthFx.changeState():window.setTimeout(bookWidthFx.changeState,twoPageBook.flipSpeed))},changeState:function(){if(el.id("bookWidthBG1")){var a;if("toFat"==bookWidthFx.widthChangeL)a=el.id("bookWidthBG1"),a.style.width="18px",a.style.left=bookWidthFx.shiftL+"px",a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_03.png")',a=el.id("bookWidthBG2"),a.style.width=
"18px",a.style.left=bookWidthFx.shiftL+"px",a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_07.png")',a=el.id("bookWidthBG3"),a.style.width="18px",a.style.left=bookWidthFx.shiftL+"px",a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_11.png")';else if("toThin"==bookWidthFx.widthChangeL)a=el.id("bookWidthBG1"),a.style.width="9px",a.style.left=bookWidthFx.shiftL+"px",a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_03Thin.png")',a=el.id("bookWidthBG2"),a.style.width="9px",
a.style.left=bookWidthFx.shiftL+"px",a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_07Thin.png")',a=el.id("bookWidthBG3"),a.style.width="9px",a.style.left=bookWidthFx.shiftL+"px",a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_11Thin.png")';if("toFat"==bookWidthFx.widthChangeR)a=el.id("bookWidthBG5"),a.style.width="18px",a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_05.png")',a=el.id("bookWidthBG6"),a.style.width="18px",a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_08.png")',
a=el.id("bookWidthBG7"),a.style.width="18px",a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_14.png")';else if("toThin"==bookWidthFx.widthChangeR)a=el.id("bookWidthBG5"),a.style.width="9px",a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_05Thin.png")',a=el.id("bookWidthBG6"),a.style.width="9px",a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_08Thin.png")',a=el.id("bookWidthBG7"),a.style.width="9px",a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_14Thin.png")';
var b=1*twoPageBook.bookWidth/2,b=b.toFixed();if("toLeft"==bookWidthFx.widthChangeB)a=el.id("bookWidthBG1"),a.style.left=bookWidthFx.shiftL+"px",a=el.id("bookWidthBG2"),a.style.left=bookWidthFx.shiftL+"px",a=el.id("bookWidthBG3"),a.style.left=bookWidthFx.shiftL+"px",a=el.id("bookWidthBG4"),a.style.left="0px",a.style.width=b+"px",a=el.id("bookWidthBG5"),a.style.left=b+"px",a=el.id("bookWidthBG6"),a.style.left=b+"px",a=el.id("bookWidthBG7"),a.style.left=b+"px";else if("toRight"==bookWidthFx.widthChangeB)a=
el.id("bookWidthBG1"),a.style.left=1*b+1*bookWidthFx.shiftL+"px",a=el.id("bookWidthBG2"),a.style.left=1*b+1*bookWidthFx.shiftL+"px",a=el.id("bookWidthBG3"),a.style.left=1*b+1*bookWidthFx.shiftL+"px",a=el.id("bookWidthBG4"),a.style.left=b+"px",a.style.width=1*twoPageBook.bookWidth-1*b+"px",a=el.id("bookWidthBG5"),a.style.left=twoPageBook.bookWidth+"px",a=el.id("bookWidthBG6"),a.style.left=twoPageBook.bookWidth+"px",a=el.id("bookWidthBG7"),a.style.left=twoPageBook.bookWidth+"px";else if("toLandscape"==
bookWidthFx.widthChangeB)a=el.id("bookWidthBG1"),a.style.left=bookWidthFx.shiftL+"px",a=el.id("bookWidthBG2"),a.style.left=bookWidthFx.shiftL+"px",a=el.id("bookWidthBG3"),a.style.left=bookWidthFx.shiftL+"px",a=el.id("bookWidthBG4"),a.style.left="0px",a.style.width=1*twoPageBook.bookWidth+"px",a=el.id("bookWidthBG5"),a.style.left=1*twoPageBook.bookWidth+"px",a=el.id("bookWidthBG6"),a.style.left=1*twoPageBook.bookWidth+"px",a=el.id("bookWidthBG7"),a.style.left=1*twoPageBook.bookWidth+"px"}else bookWidthFx.draw()},
draw:function(){if(onePageBook.installed){var a=el.add("div");a.id="bookWidthBG1";a.style.zIndex="-1";a.style.width="9px";a.style.height="8px";a.style.left="-9px";a.style.top="0px";a.style.position="absolute";a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_03Thin.png")';el.id("bookWidth").appendChild(a);a=el.add("div");a.id="bookWidthBG2";a.style.zIndex="-1";a.style.width="9px";a.style.height=1*onePageBook.bookHeight-8+"px";a.style.left="-9px";a.style.top="8px";a.style.position="absolute";
a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_07Thin.png")  repeat-y';el.id("bookWidth").appendChild(a);a=el.add("div");a.id="bookWidthBG3";a.style.zIndex="-1";a.style.width="9px";a.style.height="13px";a.style.left="-9px";a.style.top=1*onePageBook.bookHeight+"px";a.style.position="absolute";a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_11Thin.png")';el.id("bookWidth").appendChild(a);a=el.add("div");a.id="bookWidthBG4";a.style.zIndex="-1";a.style.width=onePageBook.bookWidth+
"px";a.style.height="13px";a.style.left="0px";a.style.top=1*onePageBook.bookHeight+"px";a.style.position="absolute";a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_12.png") repeat-x';el.id("bookWidth").appendChild(a);if("fat"==bookWidthFx.widthStateR)a=el.add("div"),a.id="bookWidthBG5",a.style.zIndex="-1",a.style.width="18px",a.style.height="8px",a.style.left=1*onePageBook.bookWidth+"px",a.style.top="0px",a.style.position="absolute",a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_05.png")',
el.id("bookWidth").appendChild(a),a=el.add("div"),a.id="bookWidthBG6",a.style.zIndex="-1",a.style.width="18px",a.style.height=1*onePageBook.bookHeight-8+"px",a.style.left=1*onePageBook.bookWidth+"px",a.style.top="8px",a.style.position="absolute",a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_08.png") repeat-y',el.id("bookWidth").appendChild(a),a=el.add("div"),a.id="bookWidthBG7",a.style.zIndex="-1",a.style.width="18px",a.style.height="13px",a.style.left=1*onePageBook.bookWidth+"px",a.style.top=
1*onePageBook.bookHeight+"px",a.style.position="absolute",a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_14.png")',el.id("bookWidth").appendChild(a);else if("thin"==bookWidthFx.widthStateR)a=el.add("div"),a.id="bookWidthBG5",a.style.zIndex="-1",a.style.width="9px",a.style.height="8px",a.style.left=1*onePageBook.bookWidth+"px",a.style.top="0px",a.style.position="absolute",a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_05Thin.png")',el.id("bookWidth").appendChild(a),a=el.add("div"),
a.id="bookWidthBG6",a.style.zIndex="-1",a.style.width="9px",a.style.height=1*onePageBook.bookHeight-8+"px",a.style.left=1*onePageBook.bookWidth+"px",a.style.top="8px",a.style.position="absolute",a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_08Thin.png") repeat-y',el.id("bookWidth").appendChild(a),a=el.add("div"),a.id="bookWidthBG7",a.style.zIndex="-1",a.style.width="9px",a.style.height="13px",a.style.left=1*onePageBook.bookWidth+"px",a.style.top=1*onePageBook.bookHeight+"px",a.style.position=
"absolute",a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_14Thin.png")',el.id("bookWidth").appendChild(a)}else if(twoPageBook.installed){var b=0,c=0,d=0,e=twoPageBook.bookWidth,a=1*twoPageBook.bookWidth/2,a=a.toFixed(),d="right"==bookWidthFx.twoPageState?a:0;"right"==bookWidthFx.twoPageState?b=a:"Landscape"==bookWidthFx.twoPageState&&(b=0);"left"==bookWidthFx.twoPageState?c=a:"Landscape"==bookWidthFx.twoPageState&&(c=0);e="Landscape"==bookWidthFx.twoPageState?1*twoPageBook.bookWidth:1*
twoPageBook.bookWidth-a;if("fat"==bookWidthFx.widthStateL)a=el.add("div"),a.id="bookWidthBG1",a.style.zIndex="-1",a.style.width="18px",a.style.height="8px",a.style.left=b-18+"px",a.style.top="0px",a.style.position="absolute",a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_03.png")',el.id("bookWidth").appendChild(a),a=el.add("div"),a.id="bookWidthBG2",a.style.zIndex="-1",a.style.width="18px",a.style.height=1*twoPageBook.bookHeight-8+"px",a.style.left=b-18+"px",a.style.top="8px",a.style.position=
"absolute",a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_07.png") repeat-y',el.id("bookWidth").appendChild(a),a=el.add("div"),a.id="bookWidthBG3",a.style.zIndex="-1",a.style.width="18px",a.style.height="13px",a.style.left=b-18+"px",a.style.top=1*twoPageBook.bookHeight+"px",a.style.position="absolute",a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_11.png")',el.id("bookWidth").appendChild(a);else if("thin"==bookWidthFx.widthStateL)a=el.add("div"),a.id="bookWidthBG1",a.style.zIndex=
"-1",a.style.width="9px",a.style.height="8px",a.style.left=b-9+"px",a.style.top="0px",a.style.position="absolute",a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_03Thin.png")',el.id("bookWidth").appendChild(a),a=el.add("div"),a.id="bookWidthBG2",a.style.zIndex="-1",a.style.width="9px",a.style.height=1*twoPageBook.bookHeight-8+"px",a.style.left=b-9+"px",a.style.top="8px",a.style.position="absolute",a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_07Thin.png") repeat-y',el.id("bookWidth").appendChild(a),
a=el.add("div"),a.id="bookWidthBG3",a.style.zIndex="-1",a.style.width="9px",a.style.height="13px",a.style.left=b-9+"px",a.style.top=1*twoPageBook.bookHeight+"px",a.style.position="absolute",a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_11Thin.png")',el.id("bookWidth").appendChild(a);if("fat"==bookWidthFx.widthStateR)a=el.add("div"),a.id="bookWidthBG5",a.style.zIndex="-1",a.style.width="18px",a.style.height="8px",a.style.left=1*twoPageBook.bookWidth+c+"px",a.style.top="0px",a.style.position=
"absolute",a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_05.png")',el.id("bookWidth").appendChild(a),a=el.add("div"),a.id="bookWidthBG6",a.style.zIndex="-1",a.style.width="18px",a.style.height=1*twoPageBook.bookHeight-8+"px",a.style.left=1*twoPageBook.bookWidth+c+"px",a.style.top="8px",a.style.position="absolute",a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_08.png") repeat-y',el.id("bookWidth").appendChild(a),a=el.add("div"),a.id="bookWidthBG7",a.style.zIndex="-1",a.style.width=
"18px",a.style.height="13px",a.style.left=1*twoPageBook.bookWidth+c+"px",a.style.top=1*twoPageBook.bookHeight+"px",a.style.position="absolute",a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_14.png")',el.id("bookWidth").appendChild(a);else if("thin"==bookWidthFx.widthStateR)a=el.add("div"),a.id="bookWidthBG5",a.style.zIndex="-1",a.style.width="9px",a.style.height="8px",a.style.left=1*twoPageBook.bookWidth+c+"px",a.style.top="0px",a.style.position="absolute",a.style.background='url("'+STYLES_SRC+
'bookWidth/bookWidth_05Thin.png")',el.id("bookWidth").appendChild(a),a=el.add("div"),a.id="bookWidthBG6",a.style.zIndex="-1",a.style.width="9px",a.style.height=1*twoPageBook.bookHeight-8+"px",a.style.left=1*twoPageBook.bookWidth+c+"px",a.style.top="8px",a.style.position="absolute",a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_08Thin.png") repeat-y',el.id("bookWidth").appendChild(a),a=el.add("div"),a.id="bookWidthBG7",a.style.zIndex="-1",a.style.width="9px",a.style.height="13px",a.style.left=
1*twoPageBook.bookWidth+c+"px",a.style.top=1*twoPageBook.bookHeight+"px",a.style.position="absolute",a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_14Thin.png")',el.id("bookWidth").appendChild(a);a=el.add("div");a.id="bookWidthBG4";a.style.zIndex="-1";a.style.width=e+"px";a.style.height="13px";a.style.left=d+"px";a.style.top=1*twoPageBook.bookHeight+"px";a.style.position="absolute";a.style.background='url("'+STYLES_SRC+'bookWidth/bookWidth_12.png") repeat-x';el.id("bookWidth").appendChild(a)}}},
browser={name:"",version:"",platform:"",scale:1,detect:function(){var a=navigator.userAgent.toLowerCase(),b=navigator.platform.toLowerCase(),c=a.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0];mode="ie"==c[1]&&document.documentMode;browser.name="version"==c[1]?c[3]:c[1];if("opera"===browser.name)crossHTML5.prefix="-o-";else if("safari"===browser.name)crossHTML5.prefix="-webkit-";else if("firefox"===browser.name)crossHTML5.prefix=
"-moz-";else if("ie"===browser.name)crossHTML5.prefix="-ms-";browser.version=mode||parseFloat("opera"==c[1]&&c[4]?c[4]:c[2]);browser.platform={name:a.match(/ip(?:ad|od|hone)/)?"ios":a.match(/(?:msie 9)/)?"wphone":(a.match(/(?:webos|android|bada|symbian|palm|blackberry)/)||b.match(/mac|win|linux/)||["other"])[0]};browser.device=a.match(/ipad/)?"iPad":a.match(/iphone/)?"iPhone":a.match(/android/)?"android":!1;browser.publisher={name:a.match(/(?:preview_publisher_2)/)?"Publisher2":(a.match(/(?:publisher_3|publisher)/)||
["other"])[0],device:a.match(/ipad/)?"iPad":a.match(/iphone/)?"iPhone":a.match(/android/)?"android":!1,orientation:a.match(/portrait/)?"portrait":a.match(/landscape/)?"landscape":!1,isOn:a.match(/(?:preview_publisher)/)?!0:!1};if(browser.publisher.isOn){if("iPad"==browser.publisher.device)browser.scale="portrait"==browser.publisher.orientation?1024/window.innerHeight:1024/window.innerWidth;if("iPhone"==browser.publisher.device)browser.scale="portrait"==browser.publisher.orientation?600/window.innerHeight:
600/window.innerWidth;if("android"==browser.publisher.device)browser.scale="portrait"==browser.publisher.orientation?1024/window.innerHeight:1024/window.innerWidth}browser[browser.name]=!0;browser[browser.name+parseInt(browser.version,10)]=!0;browser.platform[browser.platform.name]=!0;if(browser.platform.android)a=document.createElement("meta"),a.name="viewport",a.content="user-scalable=0; target-densitydpi=device-dpi",document.getElementsByTagName("head")[0].appendChild(a)}},buttons={bgImg:"#000",
bgImgOnclick:"#ccc",height:20,margin:10,fieldWidth:40,fieldHeight:30,infoWidth:25,infoHeight:25,infoMargin:15,navigation:{parentNodeId:"",installed:!1,draw:function(a){var b=el.add("span");b.className="navigationField";b.id="navigationField";a.appendChild(b);buttons.navigation.first.draw(b);buttons.navigation.prev.draw(b);"navigationField"==buttons.slideShow.parentNodeId&&"true"==bookData.slideshowVisible&&buttons.slideShow.draw(b);buttons.navigation.next.draw(b);buttons.navigation.last.draw(b);buttons.navigation.installed=
!0},first:{srcActive:STYLES_SRC+"navigation/activefirst.png",srcInActive:STYLES_SRC+"navigation/inactivefirst.png",installed:!1,draw:function(a){var b=el.add("img");b.id="keyFirst";b.className="navigationButtons";b.src=buttons.navigation.first.srcInActive;b.style.height=buttons.navigation.height+"px";b.style.margin=buttons.navigation.margin+"px";buttons.navigation.first.events(b);buttons.navigation.first.installed=!0;a.appendChild(b)},check:function(a){if(buttons.navigation.first.installed)if(0==
a)el.id("keyFirst").src=buttons.navigation.first.srcInActive;else if(1==a)el.id("keyFirst").src=buttons.navigation.first.srcActive},action:function(){"unlock"==slideShow.state&&pageMediator.goToPage(1)},events:function(a){!1==eventManager.touchInterface?a.addEventListener("mouseup",buttons.navigation.first.action):(a.addEventListener("touchend",buttons.navigation.first.action),a.addEventListener("touchmove",buttons.lockMove))}},prev:{srcActive:STYLES_SRC+"navigation/activeprev.png",srcInActive:STYLES_SRC+
"navigation/inactiveprev.png",installed:!1,draw:function(a){var b=el.add("img");b.id="keyPrev";b.className="navigationButtons";b.src=buttons.navigation.prev.srcInActive;b.style.height=buttons.navigation.height+"px";b.style.margin=buttons.navigation.margin+"px";buttons.navigation.prev.events(b);buttons.navigation.prev.installed=!0;a.appendChild(b)},check:function(a){if(buttons.navigation.prev.installed)if(0==a)el.id("keyPrev").src=buttons.navigation.prev.srcInActive;else if(1==a)el.id("keyPrev").src=
buttons.navigation.prev.srcActive},action:function(){"unlock"==slideShow.state&&pageMediator.prev()},events:function(a){!1==eventManager.touchInterface?a.addEventListener("mouseup",buttons.navigation.prev.action):(a.addEventListener("touchend",buttons.navigation.prev.action),a.addEventListener("touchmove",buttons.lockMove))}},next:{srcActive:STYLES_SRC+"navigation/activenext.png",srcInActive:STYLES_SRC+"navigation/inactivenext.png",installed:!1,draw:function(a){var b=el.add("img");b.id="keyNext";
b.className="navigationButtons";b.src=buttons.navigation.next.srcInActive;b.style.height=buttons.navigation.height+"px";b.style.margin=buttons.navigation.margin+"px";buttons.navigation.next.events(b);buttons.navigation.next.installed=!0;a.appendChild(b)},check:function(a){if(buttons.navigation.next.installed)if(0==a)el.id("keyNext").src=buttons.navigation.next.srcInActive;else if(1==a)el.id("keyNext").src=buttons.navigation.next.srcActive},action:function(){"unlock"==slideShow.state&&pageMediator.next()},
events:function(a){!1==eventManager.touchInterface?a.addEventListener("mouseup",buttons.navigation.next.action):(a.addEventListener("touchend",buttons.navigation.next.action),a.addEventListener("touchmove",buttons.lockMove))}},last:{srcActive:STYLES_SRC+"navigation/activelast.png",srcInActive:STYLES_SRC+"navigation/inactivelast.png",installed:!1,draw:function(a){var b=el.add("img");b.id="keyLast";b.className="navigationButtons";b.src=buttons.navigation.last.srcInActive;b.style.height=buttons.navigation.height+
"px";b.style.margin=buttons.navigation.margin+"px";buttons.navigation.last.events(b);buttons.navigation.last.installed=!0;a.appendChild(b)},check:function(a){if(buttons.navigation.last.installed)if(0==a)el.id("keyLast").src=buttons.navigation.last.srcInActive;else if(1==a)el.id("keyLast").src=buttons.navigation.last.srcActive},action:function(){"unlock"==slideShow.state&&pageMediator.goToPage(bookData.pageCount)},events:function(a){!1==eventManager.touchInterface?a.addEventListener("mouseup",buttons.navigation.last.action):
(a.addEventListener("touchend",buttons.navigation.last.action),a.addEventListener("touchmove",buttons.lockMove))}}},slideShow:{parentNodeId:"",srcActive:STYLES_SRC+"navigation/activeslideshow.png",srcInActive:STYLES_SRC+"navigation/inactiveslideshow.png",installed:!1,draw:function(a){var b=el.add("img");b.id="keySlideShow";b.className="navigationButtons";b.src=buttons.slideShow.srcActive;b.style.height=buttons.navigation.height+"px";b.style.margin=buttons.navigation.margin+"px";buttons.slideShow.events(b);
buttons.slideShow.installed=!0;a.appendChild(b)},check:function(){if(buttons.slideShow.installed)zoomBook.installed?el.id("keySlideShow").src=buttons.slideShow.srcInActive:el.id("keySlideShow").src=buttons.slideShow.srcActive},action:function(){zoomBook.installed||(slideShow.toGo(),buttons.check())},events:function(a){!1==eventManager.touchInterface?a.addEventListener("mouseup",buttons.slideShow.action):(a.addEventListener("touchend",buttons.slideShow.action),a.addEventListener("touchmove",buttons.lockMove))}},
toc:{parentNodeId:"",src:STYLES_SRC+"buttons/toc.png",installed:!1,width:30,height:30,marginTop:0,marginLeft:5,draw:function(a){var b=el.add("span");b.id="tocField";b.className="buttonsField";b.style.width=buttons.fieldWidth+"px";b.style.height=buttons.fieldHeight+"px";a.appendChild(b);a=el.add("img");a.id="imgTocButton";a.className="imgTocButton";a.style.height=buttons.toc.height+"px";a.style.width=buttons.toc.width+"px";a.style.margin=buttons.toc.marginTop+"px "+buttons.toc.marginLeft+"px ";a.src=
buttons.toc.src;a.style.opacity=toc.isToc?"1":"0.5";b.appendChild(a);buttons.toc.events(b);buttons.toc.installed=!0},check:function(a){if(buttons.toc.installed){var b=el.id("imgTocButton");if(toc.isToc){b.style.opacity="1";if(0==a)b.parentNode.style.backgroundColor=buttons.bgImg;if(1==a)b.parentNode.style.backgroundColor=buttons.bgImgOnclick}else b.style.opacity="0.5"}},down:function(){if(toc.isToc&&"unlock"==slideShow.state)el.id("imgTocButton").parentNode.style.backgroundColor=buttons.bgImgOnclick},
up:function(){if(toc.isToc)el.id("imgTocButton").parentNode.style.backgroundColor=buttons.bgImg},action:function(){"unlock"==slideShow.state&&toc.showFirstMenu()},events:function(a){!1==eventManager.touchInterface?(a.addEventListener("mouseup",buttons.toc.action),a.addEventListener("mousedown",buttons.toc.down),a.addEventListener("mouseup",buttons.toc.up)):(a.addEventListener("touchend",buttons.toc.action),a.addEventListener("touchstart",buttons.toc.down),a.addEventListener("touchend",buttons.toc.up))}},
back:{parentNodeId:"ContentBorder",color:"#ccc",colorOn:"#000",installed:!1,draw:function(){var a=el.add("div");a.className="backButton";a.id="backButton";var b=el.add("span");b.className="backFont";b.id="backText";b.appendChild(document.createTextNode("back"));a.appendChild(b);el.id(buttons.back.parentNodeId).appendChild(a);buttons.back.events(a);buttons.back.installed=!0},clear:function(){if(buttons.back.installed)el.del("backButton"),buttons.back.installed=!1},down:function(){if(2<=toc.level.length)el.id("backText").parentNode.style.border=
"1px solid #aaa"},check:function(){2<=toc.level.length?buttons.back.installed?el.id("backText").parentNode.style.border="none":buttons.back.draw():buttons.back.clear()},action:function(){toc.showPrevMenu()},events:function(a){el.id("backButton")&&(!1==eventManager.touchInterface?(a.addEventListener("mouseup",buttons.back.action),a.addEventListener("mousedown",buttons.back.down),a.addEventListener("mouseup",buttons.back.check)):(a.addEventListener("touchend",buttons.back.action),a.addEventListener("touchstart",
buttons.back.down),a.addEventListener("touchend",buttons.back.check),a.addEventListener("touchmove",buttons.lockMove)))}},bm:{src:STYLES_SRC+"buttons/bm.png",installed:!1,width:30,height:30,marginTop:0,marginLeft:5,draw:function(a){var b=el.add("span");b.id="bmField";b.className="buttonsField";b.style.width=buttons.fieldWidth+"px";b.style.height=buttons.fieldHeight+"px";a.appendChild(b);a=el.add("img");a.id="imgBmButton";a.className="imgBmButton";a.style.height=buttons.bm.height+"px";a.style.width=
buttons.bm.width+"px";a.style.margin=buttons.bm.marginTop+"px "+buttons.bm.marginLeft+"px ";a.src=buttons.bm.src;a.style.opacity=bm.isBm?"1":"0.5";b.appendChild(a);buttons.bm.events(b);buttons.bm.installed=!0;imgTocButton=null},check:function(a){if(buttons.toc.installed){var b=el.id("imgBmButton");if(bm.isBm){b.style.opacity="1";if(0==a)b.parentNode.style.backgroundColor=buttons.bgImg;if(1==a)b.parentNode.style.backgroundColor=buttons.bgImgOnclick}else b.style.opacity="0.5"}},down:function(){if(bm.isBm&&
"unlock"==slideShow.state)el.id("imgBmButton").parentNode.style.backgroundColor=buttons.bgImgOnclick},up:function(){if(bm.isBm)el.id("imgBmButton").parentNode.style.backgroundColor=buttons.bgImg},action:function(){"unlock"==slideShow.state&&bm.showList()},events:function(a){!1==eventManager.touchInterface?(a.addEventListener("mouseup",buttons.bm.action),a.addEventListener("mousedown",buttons.bm.down),a.addEventListener("mouseup",buttons.bm.up)):(a.addEventListener("touchend",buttons.bm.action),a.addEventListener("touchstart",
buttons.bm.down),a.addEventListener("touchend",buttons.bm.up),a.addEventListener("touchmove",buttons.lockMove))}},addBm:{parentNodeId:"",srcAdd:STYLES_SRC+"addbm.png",srcRem:STYLES_SRC+"rembm.png",installed:!1,width:30,height:30,marginTop:0,marginLeft:5,draw:function(a){var b=el.add("span");b.id="addField";b.className="buttonsField";b.style.width=buttons.fieldWidth+"px";b.style.height=buttons.fieldHeight+"px";a.appendChild(b);a=el.add("img");a.id="imgAddButton";a.className="imgAddButton";a.style.height=
buttons.addBm.height+"px";a.style.width=buttons.addBm.width+"px";a.style.margin=buttons.addBm.marginTop+"px "+buttons.addBm.marginLeft+"px ";a.src=bm.isAdd?buttons.addBm.srcAdd:buttons.addBm.srcRem;b.appendChild(a);buttons.addBm.events(b);buttons.addBm.installed=!0},check:function(){if(buttons.addBm.installed){elem=el.id("imgAddButton");if(onePageBook.installed||zoomBook.installed)bookData.page[pageMediator.getPage()].mark?(bm.isAdd=!1,elem.src=buttons.addBm.srcRem):(bm.isAdd=!0,elem.src=buttons.addBm.srcAdd);
else if(twoPageBook.installed)bookData.page[pageMediator.getPage()].mark||(pageMediator.getPage("right")==bookData.pageCount?0:bookData.page[pageMediator.getPage("right")].mark)?(bm.isAdd=!1,elem.src=buttons.addBm.srcRem):(bm.isAdd=!0,elem.src=buttons.addBm.srcAdd);elem=null}},down:function(){if("unlock"==slideShow.state)el.id("imgAddButton").parentNode.style.backgroundColor=buttons.bgImgOnclick},up:function(){el.id("imgAddButton").parentNode.style.backgroundColor=buttons.bgImg},action:function(){"unlock"==
slideShow.state&&bm.addButton.action()},events:function(a){!1==eventManager.touchInterface?(a.addEventListener("mouseup",buttons.addBm.up),a.addEventListener("mouseup",buttons.addBm.action),a.addEventListener("mousedown",buttons.addBm.down)):(a.addEventListener("touchstart",buttons.addBm.down),a.addEventListener("touchend",buttons.addBm.up),a.addEventListener("touchend",buttons.addBm.action),a.addEventListener("touchmove",buttons.lockMove))}},search:{parentNodeId:"",src:STYLES_SRC+"buttons/search.png",
installed:!1,width:30,height:30,marginTop:0,marginLeft:5,draw:function(a){var b=el.add("span");b.id="searchField";b.className="buttonsField";b.style.width=buttons.fieldWidth+"px";b.style.height=buttons.fieldHeight+"px";a.appendChild(b);a=el.add("img");a.id="imgSearchButton";a.className="imgSearchButton";a.style.height=buttons.search.height+"px";a.style.width=buttons.search.width+"px";a.style.margin=buttons.search.marginTop+"px "+buttons.search.marginLeft+"px ";a.src=buttons.search.src;b.appendChild(a);
buttons.search.events(b);buttons.search.installed=!0},check:function(a){if(buttons.search.installed){var b=el.id("imgSearchButton");if(0==a)b.parentNode.style.backgroundColor=buttons.bgImg;if(1==a)b.parentNode.style.backgroundColor=buttons.bgImgOnclick}},down:function(){if("unlock"==slideShow.state)el.id("imgSearchButton").parentNode.style.backgroundColor=buttons.bgImgOnclick},up:function(){el.id("imgSearchButton").parentNode.style.backgroundColor=buttons.bgImg},action:function(){},events:function(a){!1==
eventManager.touchInterface?(a.addEventListener("mouseup",buttons.search.action),a.addEventListener("mousedown",buttons.search.down),a.addEventListener("mouseup",buttons.search.up)):(a.addEventListener("touchend",buttons.search.action),a.addEventListener("touchstart",buttons.search.down),a.addEventListener("touchend",buttons.search.up),a.addEventListener("touchmove",buttons.lockMove))}},edit:{},info:{parentNodeId:"",src:STYLES_SRC+"buttons/info.png",isShow:!1,width:25,height:25,margin:0,imgWidth:25,
imgHeight:25,draw:function(a){var b=el.add("span");b.id="infoField";b.className="infoField";b.style.width=buttons.info.width+"px";b.style.height=buttons.info.height+"px";b.style.margin=buttons.info.margin+"px";a.appendChild(b);a=el.add("img");a.id="imgInfoButton";a.className="imgInfoButton";a.style.width=buttons.info.imgWidth+"px";a.style.height=buttons.info.imgHeight+"px";a.src=buttons.info.src;b.appendChild(a);buttons.info.events(b);buttons.info.installed=!0},action:function(){if("unlock"==slideShow.state&&
(el.id("imgInfoButton").parentNode.style.backgroundColor=buttons.bgImg,toolbar.toogle(),eventManager.lock=!0,"hide"==ctrlEngine.state))ctrlEngine.mode="info",ctrlEngine.display()},down:function(){if("unlock"==slideShow.state)el.id("imgInfoButton").parentNode.style.backgroundColor=buttons.bgImgOnclick},events:function(a){!1==eventManager.touchInterface?(a.addEventListener("mouseup",buttons.info.action),a.addEventListener("mousedown",buttons.info.down)):(a.addEventListener("touchend",buttons.info.action),
a.addEventListener("touchstart",buttons.info.down),a.addEventListener("touchmove",buttons.lockMove))}},exit:{parentNodeId:"",src:STYLES_SRC+"buttons/exit.png",draw:function(a){var b=el.add("span");b.className="exitField";b.id="exitField";a.appendChild(b);a=el.add("img");a.id="imgExitButton";a.className="imgExitButton";a.src=buttons.exit.src;b.appendChild(a);buttons.exit.events(b)},action:function(){el.id("imgExitButton").parentNode.style.border="none";if("info"==ctrlEngine.mode)ctrlEngine.hide(),
eventManager.lock=!1,toolbar.toogle()},down:function(){el.id("imgExitButton").parentNode.style.border="1px solid #aaa"},events:function(a){!1==eventManager.touchInterface?(a.addEventListener("mouseup",buttons.exit.action),a.addEventListener("mousedown",buttons.exit.down)):(a.addEventListener("touchend",buttons.exit.action),a.addEventListener("touchstart",buttons.exit.down))}},share:{},check:function(){var a=pageMediator.getPage();"lock"==slideShow.state?(buttons.navigation.first.check(0),buttons.navigation.prev.check(0),
buttons.navigation.next.check(0),buttons.navigation.last.check(0)):(1==a?(buttons.navigation.first.check(0),buttons.navigation.prev.check(0)):(buttons.navigation.first.check(1),buttons.navigation.prev.check(1)),pageMediator.isLastPage()?(buttons.navigation.next.check(0),buttons.navigation.last.check(0)):(buttons.navigation.next.check(1),buttons.navigation.last.check(1)));buttons.addBm.check()},lockMove:function(a){a.preventDefault()}},crossHTML5={prefix:"",perspective:function(a,b){a.style[this.prefix+
"perspective"]=b},backfaceVisibility:function(a,b){a.style[this.prefix+"backface-visibility"]=b},boxShadow:function(a,b){a.style[this.prefix+"box-shadow"]=b},transitionDuration:function(a,b){a.style[this.prefix+"transition-duration"]=b},transform:function(a,b,c){b=b||!1;c=c||!1;if(!b&&!c)return a.style[this.prefix+"transform"];a.style[this.prefix+"transform"]="-webkit-"===this.prefix?b:c}},ctrlEngine={state:"hide",mode:"toc",init:function(){toc.init();bm.init();toolbar.draw()},border:{width:350,height:390,
orientation:"top",left:0,top:0,isFx:!0,draw:function(){ctrlEngine.border.width="info"==ctrlEngine.mode?ctrlEngine.border.wInfo:ctrlEngine.border.wMain;ctrlEngine.border.width="info"==ctrlEngine.mode?device.width()-10<ctrlEngine.border.width?device.width()-10:ctrlEngine.border.width:device.width()-ctrlEngine.border.left-ctrlEngine.border.right<ctrlEngine.border.width?device.width()-ctrlEngine.border.left-ctrlEngine.border.right:ctrlEngine.border.width;ctrlEngine.border.height="info"==ctrlEngine.mode?
device.height():0.8*device.height();var a=el.add("div");a.className="contentBorder";a.id="ContentBorder";a.style.height=ctrlEngine.border.height+"px";a.style.width=ctrlEngine.border.width+"px";if("top"==ctrlEngine.border.orientation)ctrlEngine.border.isFx?(a.style.top=-(ctrlEngine.border.height+ctrlEngine.border.top+2)+"px",window.setTimeout(ctrlEngine.border.toogle,50)):a.style.top=ctrlEngine.border.top+"px",a.style.left="info"==ctrlEngine.mode?(device.width()-ctrlEngine.border.width)/2+"px":ctrlEngine.border.left+
"px";var b="";if("toc"==ctrlEngine.mode)b=buttons.toc.parentNodeId;if("bm"==ctrlEngine.mode)b=buttons.bm.parentNodeId;"info"==ctrlEngine.mode&&(b="infoToolbar",buttons.exit.draw(a));var c={},c=el.id(b);c.appendChild(a);b=el.add("div");b.className="contentBorderInner";b.id="Content";b.style.height=ctrlEngine.border.height-ctrlEngine.border.hHeader-ctrlEngine.border.margin+"px";b.style.width=ctrlEngine.border.width-2*ctrlEngine.border.margin+"px";a.appendChild(b)},toogle:function(){var a=el.id("ContentBorder");
"display"==ctrlEngine.state&&ctrlEngine.border.transform(a,1);"hide"==ctrlEngine.state&&ctrlEngine.border.transform(a,0)},transform:function(a,b){var c=0;"top"==ctrlEngine.border.orientation&&(c="info"==ctrlEngine.mode?(ctrlEngine.border.height+ctrlEngine.border.top+2)*b+14:(ctrlEngine.border.height+ctrlEngine.border.top+2)*b-2,crossHTML5.transitionDuration(a,ctrlEngine.border.speed),crossHTML5.transform(a,"translate3d(0px,"+c+"px,100px)","translateY("+c+"px) translateZ(100px)"))}},lable:{draw:function(){var a=
el.add("div");a.className="contentLable";a.id="ContentLable";var b=el.add("h1");b.className="lableFont";var c="";"toc"==ctrlEngine.mode?c=document.createTextNode("Table of Contents"):"bm"==ctrlEngine.mode?c=document.createTextNode("Bookmarks"):"info"==ctrlEngine.mode&&(c=document.createTextNode("Help"));b.appendChild(c);a.appendChild(b);el.id("ContentBorder").appendChild(a)},clear:function(){el.del("ContentLable")}},content:{init:function(){var a=el.add("div");a.style.width=ctrlEngine.border.width-
2*ctrlEngine.border.margin+"px";a.id="ContentInner";a.style.position="absolute";a.style.webkitUserSelect="none";a.style.webkitTransitionDuration=toc.shiftSpeed+"ms";el.id("Content").appendChild(a);ctrlEngine.events.scroll()},clear:function(){el.del("ContentInner")},generateList:{toc:function(a,b,c){if(a){var d=el.add("ul");d.id="Menu"+b;d.className="tocUL";d.style.width=ctrlEngine.border.width-2*ctrlEngine.border.margin+"px";d.style.left=b*ctrlEngine.border.width+"px";c?el.id("ContentInner").appendChild(d):
el.id("ContentInner").insertBefore(d,el.id("Menu"+(b+1)));for(var e in a.tocElement){b=el.add("li");b.className="tocLI";b.style.width=ctrlEngine.border.width-2*ctrlEngine.border.margin+"px";b.setAttribute("page",a.tocElement[e].page);b.setAttribute("position",e);b.setAttribute("child",a.tocElement[e].children?"yes":"no");c=el.add("span");c.className="tocContent";c.style.width=ctrlEngine.border.width-57+"px";c.appendChild(document.createTextNode(a.tocElement[e].name));b.appendChild(c);if("yes"==b.getAttribute("child"))c=
el.add("img"),c.className="tocContent",c.style.width="22px",c.src=STYLES_SRC+"subtoc.png",b.appendChild(c);d.appendChild(b);ctrlEngine.events.subToc(b)}}},bm:function(){var a=el.add("ul");a.style.width=ctrlEngine.border.width-2*ctrlEngine.border.margin+"px";a.id="MenuBM";a.className="bmUL";el.id("ContentInner").appendChild(a);for(var b in bookData.BM.bmElement){var c=el.add("li");c.className="bmLI";c.id="LiBM"+b;c.setAttribute("page",b);c.setAttribute("name",bookData.BM.bmElement[b]);c.setAttribute("select",
!1);var d=el.add("span");d.className="bmContent";d.style.width=ctrlEngine.border.width-85+"px";d.appendChild(document.createTextNode(bookData.BM.bmElement[b]));c.appendChild(d);d=el.add("span");d.className="bmContent";d.style.width="50px";d.appendChild(document.createTextNode("p. "+b));c.appendChild(d);a.appendChild(c);ctrlEngine.events.bmList(c);liToc=null}},info:function(){var a=el.add("div");a.className="infoBG";a.id="infoBG";a.style.width=device.width()+"px";a.style.height=device.height()+50+
"px";el.id("infoToolbar").appendChild(a);a.addEventListener("touchmove",buttons.lockMove);var b=el.add("ul");b.id="Gesture List";b.style.width=ctrlEngine.border.width-2*ctrlEngine.border.margin+"px";b.id="MenuInfo";b.className="infoUL";el.id("ContentInner").appendChild(b);var c=el.add("span");c.className="infoCategoryFont";var d=document.createTextNode("Gestures");c.appendChild(d);b.appendChild(c);d=0;for(d in bookData.info.gestures){var e=el.add("li");e.className="infoLI";c=el.add("img");c.className=
"infoContent";c.src=bookData.info.gestures[d].src;e.appendChild(c);a=el.add("div");a.className="infoContent";a.style.margin="15px 0 0 0";c=el.add("span");c.className="infoNameFont";c.appendChild(document.createTextNode(bookData.info.gestures[d].h1));a.appendChild(c);c=el.add("span");c.className="infoDescriptionFont";c.appendChild(document.createTextNode(bookData.info.gestures[d].p));a.appendChild(c);e.appendChild(a);b.appendChild(e)}b=el.add("ul");b.id="Toolbar options";b.style.width=ctrlEngine.border.width-
2*ctrlEngine.border.margin+"px";b.id="MenuInfo";b.className="infoUL";el.id("ContentInner").appendChild(b);c=el.add("span");c.className="infoCategoryFont";d=document.createTextNode("Toolbar options");c.appendChild(d);b.appendChild(c);d=0;for(d in bookData.info.toolbar)e=el.add("li"),e.className="infoLI",c=el.add("img"),c.className="infoContent",c.src=bookData.info.toolbar[d].src,c.style.margin="10px 35px",c.style.height="40px",e.appendChild(c),a=el.add("div"),a.className="infoContent",a.style.margin=
"10px 0 0 0",c=el.add("span"),c.className="infoDescriptionFont",c.appendChild(document.createTextNode(bookData.info.toolbar[d].p)),a.appendChild(c),e.appendChild(a),b.appendChild(e);b=el.add("ul");b.id="Navigation";b.style.width=ctrlEngine.border.width-2*ctrlEngine.border.margin+"px";b.id="MenuInfo";b.className="infoUL";el.id("ContentInner").appendChild(b);c=el.add("span");c.className="infoCategoryFont";d=document.createTextNode("Navigation");c.appendChild(d);b.appendChild(c);d=0;for(d in bookData.info.navigation)e=
el.add("li"),e.className="infoLI",c=el.add("img"),c.className="infoContent",c.src=bookData.info.navigation[d].src,c.style.margin="5px 35px",c.style.height="25px",e.appendChild(c),a=el.add("div"),a.className="infoContent",a.style.margin="5px 0 0 0",c=el.add("span"),c.className="infoDescriptionFont",c.appendChild(document.createTextNode(bookData.info.navigation[d].p)),a.appendChild(c),e.appendChild(a),b.appendChild(e)}},remove:function(a){el.del("Menu"+a)},draw:function(){ctrlEngine.content.init();
if("toc"==ctrlEngine.mode){var a=toc.parseLevel(toc.level.length);ctrlEngine.content.generateList.toc(a,0,!0)}else"bm"==ctrlEngine.mode?ctrlEngine.content.generateList.bm():"info"==ctrlEngine.mode&&ctrlEngine.content.generateList.info()},subToc:function(a){var b=toc.level.length,c=toc.parseLevel(b);toc.tocLock=!0;toc.pageNum=a.getAttribute("page");if("yes"==a.getAttribute("child")){a.style.background="#888888";ctrlEngine.content.rightShift(b);toc.level[b]=a.getAttribute("position");ctrlEngine.content.generateList.toc(c.tocElement[toc.level[b]].children,
b,!0);var d=function(){2<toc.level.length&&ctrlEngine.content.remove(toc.level.length-3);delete d};window.setTimeout(d,toc.shiftSpeed+50);var e=function(){pageMediator.goToPage(toc.pageNum);delete e};window.setTimeout(e,toc.shiftSpeed+50);buttons.back.check()}else pageMediator.goToPage(toc.pageNum);c=b=a=null},rightShift:function(a){el.id("ContentInner").style.webkitTransform="translate3d("+a*-ctrlEngine.border.width+"px, 0px,0px)"},leftShift:function(a){el.id("ContentInner").style.webkitTransform=
"translate3d("+a*-ctrlEngine.border.width+"px, 0px,0px)"}},display:function(){if("unlock"==slideShow.state)ctrlEngine.state="display",ctrlEngine.border.draw(),ctrlEngine.lable.draw(),ctrlEngine.content.draw();window.addEventListener("orientationchange",ctrlEngine.hide,!1)},change:function(){"bm"==ctrlEngine.mode?(ctrlEngine.lable.clear(),buttons.back.clear(),ctrlEngine.content.clear()):"toc"==ctrlEngine.mode&&(ctrlEngine.lable.clear(),ctrlEngine.content.clear());ctrlEngine.lable.draw();ctrlEngine.content.draw()},
redraw:function(){ctrlEngine.content.clear();ctrlEngine.content.draw()},hide:function(){if("display"==ctrlEngine.state)"info"==ctrlEngine.mode&&el.del("infoBG"),"toc"==ctrlEngine.mode&&buttons.back.clear(),ctrlEngine.state="hide",el.del("ContentBorder")},edit:{draw:function(){},addBM:function(a,b){bookData.BM.add(a,b)},addNewBM:function(a){bookData.BM.add(a,"Bookmark "+a)},enterName:function(a){ctrlEngine.input.draw(a);ctrlEngine.input.enable(a)},changeName:function(a){var b=el.id("inputLi").parentNode;
b.parentNode.setAttribute("name",a);var c=b.parentNode.getAttribute("page");bookData.BM.change(c,a);ctrlEngine.input.state&&ctrlEngine.input.cancel(b);bm.isEdit=!1}}};
ctrlEngine.events={touchInterface:!1,downCLk:!1,moveCLk:!1,startY:0,currY:0,deltaY:0,offset:0,scrollSpeed:"0s",inputEnterEvent:function(){if(ctrlEngine.input.state){var a=function(b){13==b.keyCode&&"bm"==ctrlEngine.mode&&ctrlEngine.edit.changeName(b.target.value);delete a};el.id("inputField").addEventListener("keydown",a);elem=null}},bmList:function(a){!1==eventManager.touchInterface?(a.addEventListener("mousedown",ctrlEngine.events.downBm),a.addEventListener("mouseup",ctrlEngine.events.upBm)):(a.addEventListener("touchstart",
ctrlEngine.events.downBm),a.addEventListener("touchend",ctrlEngine.events.upBm))},subToc:function(a){!1==eventManager.touchInterface?(a.addEventListener("mousedown",ctrlEngine.events.downSubToc),a.addEventListener("mouseup",ctrlEngine.events.upSubToc)):(a.addEventListener("touchstart",ctrlEngine.events.downSubToc),a.addEventListener("touchend",ctrlEngine.events.upSubToc))},scroll:function(){!1==eventManager.touchInterface?(el.id("ContentInner").addEventListener("mousedown",ctrlEngine.events.down),
el.id("ContentInner").addEventListener("mouseup",ctrlEngine.events.up),el.id("ContentInner").addEventListener("mouseout",ctrlEngine.events.up),el.id("ContentInner").addEventListener("mousemove",ctrlEngine.events.move)):(el.id("ContentInner").addEventListener("touchstart",ctrlEngine.events.down),el.id("ContentInner").addEventListener("touchend",ctrlEngine.events.up),el.id("ContentInner").addEventListener("touchcancel",ctrlEngine.events.up),el.id("ContentInner").addEventListener("touchmove",ctrlEngine.events.move))},
getId:function(a){if(void 0==a.tagName)a=a.parentNode;if(!a.hasAttribute("page")&&(a=a.parentNode,!a.hasAttribute("page")&&(a=a.parentNode,!a.hasAttribute("page"))))console.log("\u041d\u0415 \u041e\u041f\u0420\u0415\u0414\u0415\u041b\u0415\u041d\u0410 \u0421\u0422\u0420\u0410\u041d\u0418\u0426\u0410"),a=a.parentNode;return a},getIdContentInner:function(a){if(void 0==a.tagName)a=a.parentNode;if("ContentInner"!=a.id&&(a=a.parentNode,"ContentInner"!=a.id&&(a=a.parentNode,"ContentInner"!=a.id)))a=a.parentNode,
a="ContentInner"==a.id?a:a.parentNode;return a},downBm:function(a){if(bm.isEdit&&!bm.isSelect||!bm.isEdit){a.preventDefault();var a=ctrlEngine.events.getId(a.target),b=a.parentNode.childNodes;for(i=0;i<b.length;i++)b[i].setAttribute("select",!1),b[i].style.background="";if(timer.check("fx"))a.style.background="#bbbbbb";a.setAttribute("select",!0);i=null}},upBm:function(a){if(bm.isEdit&&!bm.isSelect||!bm.isEdit)a.preventDefault(),bm.isSelect=!0,a=ctrlEngine.events.getId(a.target),0==ctrlEngine.events.deltaY&&
timer.check("fx")&&(bm.isEdit?bm.editButton.input(a.firstChild):pageMediator.goToPage(a.getAttribute("page")))},downSubToc:function(a){a.preventDefault();a=ctrlEngine.events.getId(a.target);if(timer.check("fx"))a.style.background="#bbbbbb";if(a.getAttribute("position")!=toc.mark&&0<toc.mark)a.parentNode.getElementsByTagName("LI")[toc.mark-1].style.background="",toc.mark=0},upSubToc:function(a){a.preventDefault();a=ctrlEngine.events.getId(a.target);a.style.background="";if(0==ctrlEngine.events.deltaY&&
timer.check("fx"))ctrlEngine.content.subToc(a),toc.mark=0},down:function(a){a.preventDefault();ctrlEngine.events.downClk=!0;elem="toc"==ctrlEngine.mode?ctrlEngine.events.getId(a.target).parentNode:ctrlEngine.events.getIdContentInner(a.target);ctrlEngine.events.startY=!1==eventManager.touchInterface?a.pageY-ctrlEngine.events.offset:a.targetTouches[0].clientY-ctrlEngine.events.offset;ctrlEngine.events.deltaY=0;elem=null},up:function(){ctrlEngine.events.downClk=!1},move:function(a){if(!0==ctrlEngine.events.downClk){if("info"==
ctrlEngine.mode)var b=ctrlEngine.events.getIdContentInner(a.target);else if(b=ctrlEngine.events.getId(a.target),b.style.background="","bm"==ctrlEngine.mode)b=ctrlEngine.events.getIdContentInner(a.target);else if("toc"==ctrlEngine.mode)b=b.parentNode;ctrlEngine.events.currY=!1==eventManager.touchInterface?a.pageY:a.targetTouches[0].clientY;ctrlEngine.events.deltaY=ctrlEngine.events.currY-ctrlEngine.events.startY;var c=b.parentNode.offsetHeight-b.scrollHeight;if(0<=ctrlEngine.events.deltaY+b.offsetTop)b.style.top=
"0px",ctrlEngine.events.offset=0;else if(ctrlEngine.events.deltaY>=c)b.style.top=ctrlEngine.events.deltaY+"px",prefix=ctrlEngine.events.deltaY,ctrlEngine.events.offset=prefix,prefix=null;a.preventDefault()}}};
var device={width:function(){return browser.publisher.isOn?window.innerWidth*browser.scale:window.innerWidth},height:function(){return browser.publisher.isOn?window.innerHeight*browser.scale:"iPhone"==this.name()||"iPhone"==this.name()?416==window.innerHeight&&"portrait"==orientationObserver.getOrientation()?window.innerHeight:416>window.innerHeight&&"portrait"==orientationObserver.getOrientation()?window.innerHeight+60:250<window.innerHeight&&"landscape"==orientationObserver.getOrientation()?window.innerHeight:
250>window.innerHeight&&"landscape"==orientationObserver.getOrientation()?window.innerHeight+60:window.innerHeight:window.innerHeight},proportions:function(){return(this.width()/this.height()).toFixed(2)},name:function(){var a="other",a=browser.platform.ios&&"iPad"===browser.device?"iPad":"iPhone",a=!0==browser.platform.android?"android":a,a=!0==browser.platform.wphone?"wphone":a;return browser.publisher.isOn?browser.publisher.device:a}},eventManager={touchInterface:!1,leftAndRightArea:0.15,gesture:!1,
touchStartCoordinate:{x:0,y:0},clickStartCoordinate:{x:0,y:0},click:!1,clickCount:0,doubleClickTime:250,lock:!1,start:function(){"createTouch"in document?(eventManager.touchInterface=!0,eventManager.loadTouchEvents()):(eventManager.touchInterface=!1,eventManager.loadClickEvents())},loadTouchEvents:function(){var a=document.getElementById("mainFrame"),b=function(a){eventManager.gesture=!0;a.target=a.target?a.target:a.srcElement;a.preventDefault?a.preventDefault():a.returnValue=!1;twoPageBook.installed&&
!zoomBook.installed?twoPageBook.events.gestureStart(a):onePageBook.installed&&!zoomBook.installed?onePageBook.events.gestureStart(a):zoomBook.installed&&zoomBook.events.gestureStart(a);delete b},c=function(a){a.target=a.target?a.target:a.srcElement;a.preventDefault?a.preventDefault():a.returnValue=!1;twoPageBook.installed&&!zoomBook.installed?twoPageBook.events.gestureChange(a):onePageBook.installed&&!zoomBook.installed?onePageBook.events.gestureChange(a):zoomBook.installed&&zoomBook.events.gestureChange(a);
delete c},d=function(a){a.target=a.target?a.target:a.srcElement;a.preventDefault?a.preventDefault():a.returnValue=!1;twoPageBook.installed&&!zoomBook.installed?twoPageBook.events.gestureEnd(a):onePageBook.installed&&!zoomBook.installed?onePageBook.events.gestureEnd(a):zoomBook.installed&&zoomBook.events.gestureEnd(a);window.setTimeout(function(){eventManager.gesture=!1},100);delete d};a.addEventListener("gesturestart",b,!1);a.addEventListener("gesturechange",c,!1);a.addEventListener("gestureend",
d,!1);var e=function(a){if(!eventManager.gesture)a.target=a.target?a.target:a.srcElement,"input"==pager.state&&pager.cancelInput(),eventManager.touchStartCoordinate.x=a.targetTouches[0].pageX,eventManager.touchStartCoordinate.y=a.targetTouches[0].pageY,twoPageBook.installed&&!zoomBook.installed?twoPageBook.events.touchStart(a):onePageBook.installed&&!zoomBook.installed?onePageBook.events.touchStart(a):zoomBook.installed&&zoomBook.events.touchStart(a),a.preventDefault?a.preventDefault():a.returnValue=
!1;delete e},f=function(a){if(!eventManager.gesture)a.target=a.target?a.target:a.srcElement,twoPageBook.installed&&!zoomBook.installed?twoPageBook.events.touchMove(a):onePageBook.installed&&!zoomBook.installed?onePageBook.events.touchMove(a):zoomBook.installed&&zoomBook.events.touchMove(a),a.preventDefault?a.preventDefault():a.returnValue=!1;delete f},h=function(a){if(!eventManager.gesture)a.target=a.target?a.target:a.srcElement,twoPageBook.installed&&!zoomBook.installed?twoPageBook.events.touchEnd(a):
onePageBook.installed&&!zoomBook.installed?onePageBook.events.touchEnd(a):zoomBook.installed&&zoomBook.events.touchEnd(a),a.preventDefault?a.preventDefault():a.returnValue=!1;delete h};a.addEventListener("touchstart",e,!1);a.addEventListener("touchmove",f,!1);a.addEventListener("touchend",h,!1);delete null},loadClickEvents:function(){var a=function(b){b.target=b.target?b.target:b.srcElement;b.preventDefault?b.preventDefault():b.returnValue=!1;eventManager.click=!0;"input"==pager.state&&pager.cancelInput();
eventManager.clickStartCoordinate.x=b.pageX;eventManager.clickStartCoordinate.y=b.pageY;twoPageBook.installed&&!zoomBook.installed?twoPageBook.events.mousedown(b):onePageBook.installed&&!zoomBook.installed?onePageBook.events.mousedown(b):zoomBook.installed&&zoomBook.events.mousedown(b);delete a},b=function(a){a.target=a.target?a.target:a.srcElement;a.preventDefault?a.preventDefault():a.returnValue=!1;eventManager.click=!1;twoPageBook.installed&&!zoomBook.installed?twoPageBook.events.mouseup(a):onePageBook.installed&&
!zoomBook.installed?onePageBook.events.mouseup(a):zoomBook.installed&&zoomBook.events.mouseup(a);delete b},c=function(a){a.target=a.target?a.target:a.srcElement;a.preventDefault?a.preventDefault():a.returnValue=!1;eventManager.click&&(twoPageBook.installed&&!zoomBook.installed?twoPageBook.events.mousemove(a):onePageBook.installed&&!zoomBook.installed?onePageBook.events.mousemove(a):zoomBook.installed&&zoomBook.events.mousemove(a));delete c},d=document.getElementById("mainFrame");d.addEventListener("mousedown",
a,!1);d.addEventListener("mousemove",c,!1);d.addEventListener("mouseup",b,!1);delete null},linkClick:function(a,b,c,d){if(eventManager.touchInterface)var e=a.changedTouches[0].pageX-a.target.getBoundingClientRect().left,f=a.changedTouches[0].pageY-a.target.getBoundingClientRect().top;else e=a.clientX-a.target.getBoundingClientRect().left,f=a.clientY-a.target.getBoundingClientRect().top;for(linkI in bookData.page[b].links){var h=bookData.page[b].links[linkI];if(e>=h.x*c&&e<=h.x*c+h.width*c&&f>=1*(h.y*
d).toFixed(0)&&f<=1*(1*(h.y*d).toFixed(0)+h.height*d).toFixed(0)){a.preventDefault?a.preventDefault():a.returnValue=!1;a.stopPropagation?a.stopPropagation():a.cancelBubble=!0;var g=h.x*c,j=h.y*d;if(eventManager.touchInterface){var k=a.target.getContext("2d"),l=k.getImageData(g,j,h.width*c+10,h.height*d+10);k.fillStyle="rgba(0,0,0,0.4)";k.fillRect(h.x*c,h.y*d,h.width*c,h.height*d);(function(b){a.target.addEventListener("touchend",function(){k.putImageData(l,g,j);b.page&&pageMediator.goToPage(b.page);
if(b.urls)for(var a=0;a<b.urls.length;a++)window.open(b.urls[a])})})(h)}else if(h.page&&pageMediator.goToPage(h.page),h.urls)for(var m=0;m<h.urls.length;m++)window.open(h.urls[m])}}}},images={image:new Image,imageStack:[],processing:!1,getImagePath:function(a,b,c,d){var c=c||!1,d=d||0,e="000"+a;9<a&&(e="00"+a);99<a&&(e="0"+a);999<a&&(e=""+a);null==dir&&(PATH_TO_PROPERTIES=photographer_img);if("zoom"===(b||""))return c?PATH_TO_PROPERTIES+"page"+e+"_i2_"+d+".jpg?id="+1E5*Math.random().toFixed(5)+PS+
"&":PATH_TO_PROPERTIES+"page"+e+"_i2.jpg?id="+1E5*Math.random().toFixed(5)+PS+"&";if("iPhone"==device.name())return c?PATH_TO_PROPERTIES+"page"+e+"_i1_"+d+".jpg?id="+1E5*Math.random().toFixed(5)+PS+"&":PATH_TO_PROPERTIES+"page"+e+"_i1.jpg?id="+1E5*Math.random().toFixed(5)+PS+"&";if("iPad"==device.name())return c?PATH_TO_PROPERTIES+"page"+e+"_i1_"+d+".jpg?id="+1E5*Math.random().toFixed(5)+PS+"&":PATH_TO_PROPERTIES+"page"+e+"_i1.jpg?id="+1E5*Math.random().toFixed(5)+PS+"&";if("android"==device.name()||
"wphone"==device.name())return c?PATH_TO_PROPERTIES+"page"+e+"_i1_"+d+".jpg?id="+1E5*Math.random().toFixed(5)+PS+"&":PATH_TO_PROPERTIES+"page"+e+"_i1.jpg?id="+1E5*Math.random().toFixed(5)+PS+"&";if("other"==device.name())return c?PATH_TO_PROPERTIES+"page"+e+"_i2_"+d+".jpg?id="+1E5*Math.random().toFixed(5)+PS+"&":PATH_TO_PROPERTIES+"page"+e+"_i2.jpg?id="+1E5*Math.random().toFixed(5)+PS+"&"},init:function(){this.image.onload=this.loadImage},loadImage:function(){var a=this.id;if(el.id("canvas"+a)){preloader.deletePreloader(1*
a);var b=el.id("canvas"+a),b=b.getContext("2d");if(twoPageBook.installed&&!zoomBook.installed)var c=twoPageBook.bookWidth/2,d=twoPageBook.bookHeight;else if(onePageBook.installed&&!zoomBook.installed)c=onePageBook.bookWidth,d=onePageBook.bookHeight;else if(zoomBook.installed)c=zoomBook.pageWidth,d=zoomBook.pageHeight;if(bookData.page[a].proportions>=bookData.size.proportions){var e=c,f=(e/bookData.page[a].proportions).toFixed(0);b.drawImage(images.image,0,(d-f)/2,e,f)}else f=d,e=(f*bookData.page[a].proportions).toFixed(0),
d=(c-e)/2,bookData.page[a].wide&&0==a%2?d=c-e:bookData.page[a].wide&&(d=0),b.drawImage(images.image,d,0,e,f);bookData.page[a].mark&&bm.rasterize.draw(b,a);1!=a&&a!=bookData.pageCount&&twoPageBook.installed&&!zoomBook.installed?images.drawShadow(b,a):a==bookData.pageCount&&0!=a%2&&!zoomBook.installed&&images.drawShadow(b,a);if(onePageBook.installed&&zoomBook.installed&&onePageBook.currentPage==a)onePageBook.installed=!1,window.setTimeout(function(){preloader.delSimplePreloader();el.del("tmpDiv");zoomLock.unLock()},
300);if(twoPageBook.installed&&zoomBook.installed&&zoomBook.currentPage==a)twoPageBook.installed=!1,window.setTimeout(function(){preloader.delSimplePreloader();el.del("tmpDiv");zoomLock.unLock()},300);if(zoomBook.innerZoomState&&zoomBook.currentPage==a)zoomBook.innerZoomState=!1,window.setTimeout(function(){preloader.delSimplePreloader();el.del("exZoomBook");zoomLock.unLock()},300);b=d=f=e=d=c=null}0<images.imageStack.length?images.shiftImage():images.processing=!1},drawShadow:function(a,b){if(0==
b%2){var c=a.createLinearGradient(twoPageBook.bookWidth/2-twoPageBook.bookWidth/10,0,twoPageBook.bookWidth/2,0);c.addColorStop(0,"rgba(0,0,0,0.0)");c.addColorStop(0.4,"rgba(0,0,0,0.05)");c.addColorStop(0.8,"rgba(0,0,0,0.20)");c.addColorStop(1,"rgba(0,0,0,0.15)")}else c=a.createLinearGradient(twoPageBook.bookWidth/20,0,0,0),c.addColorStop(0,"rgba(0,0,0,0)"),c.addColorStop(0.6,"rgba(0,0,0,0.1)"),c.addColorStop(0.95,"rgba(0,0,0,0.2)"),c.addColorStop(1,"rgba(0,0,0,0.65)");a.fillStyle=c;0==b%2?(a.fillRect(twoPageBook.bookWidth/
2-twoPageBook.bookWidth/4,0,twoPageBook.bookWidth/4,twoPageBook.bookHeight),a.beginPath(),a.moveTo(twoPageBook.bookWidth/2,0),a.lineTo(twoPageBook.bookWidth/2,twoPageBook.bookHeight),a.strokeStyle="rgba(0,0,0,0.1)",a.stroke()):a.fillRect(0,0,twoPageBook.bookWidth/10,twoPageBook.bookHeight)},shiftImage:function(){if(0<this.imageStack.length){this.processing=!0;var a=this.imageStack.shift();this.image.id=a;this.image.src=zoomBook.installed?bookData.page[a].srcZoom+1E5*Math.random().toFixed(5):bookData.page[a].src+
1E5*Math.random().toFixed(5)}},push:function(a){this.imageStack.push(a);this.processing||this.shiftImage()},deleteImageFromStack:function(a){a=images.imageStack.indexOf(a);-1!=a&&images.imageStack.splice(a,1)}},links={currStorage:"",currCanvas:"",currX:0,currY:0,currGoPage:0,isLinkBool:!1,currURLs:0,drawRect:function(a){links.clearRect();if(onePageBook.installed)var b=onePageBook.currentPage;else if(twoPageBook.installed)if(a.target.id=="canvas"+twoPageBook.currentPage.left)b=twoPageBook.currentPage.left;
else{if(a.target.id=="canvas"+twoPageBook.currentPage.right)b=twoPageBook.currentPage.right}else if(zoomBook.installed)b=zoomBook.currentPage;var c=a.target.width/bookData.size.width,d=a.target.height/bookData.size.height;if(eventManager.touchInterface)var e=eventManager.touchStartCoordinate.x-a.target.getBoundingClientRect().left,f=eventManager.touchStartCoordinate.y-a.target.getBoundingClientRect().top;else e=a.clientX-a.target.getBoundingClientRect().left,f=a.clientY-a.target.getBoundingClientRect().top;
if(bookData.page[b])for(linkI in bookData.page[b].links){var h=bookData.page[b].links[linkI];links.isLinkBool=!1;if(e>=h.x*c&&e<=h.x*c+h.width*c&&f>=1*(h.y*d).toFixed(0)&&f<=1*(1*(h.y*d).toFixed(0)+h.height*d).toFixed(0)){links.currX=h.x*c;links.currY=h.y*d;b=a.target.getContext("2d");links.currCanvas=a.target.id;links.currStorage=b.getImageData(links.currX,links.currY,h.width*c+10,h.height*d+10);b.fillStyle="rgba(0,0,0,0.3)";b.fillRect(h.x*c,h.y*d,h.width*c,h.height*d);links.currGoPage=h.page?h.page:
0;links.currURLs=h.urls?h.urls:0;links.isLinkBool=!0;break}}},clearRect:function(){if(el.id(links.currCanvas))el.id(links.currCanvas).getContext("2d").putImageData(links.currStorage,links.currX,links.currY),links.isLinkBool=!1}},main=function(){function a(a){"one"===bookChoice.getType()?onePageBook.draw(a):twoPageBook.draw(a);if(browser.publisher.isOn)el.id("scaler").style.position="absolute",el.id("scaler").style.overflow="hidden",el.id("scaler").style.width=window.innerWidth+"px",el.id("scaler").style.height=
window.innerHeight+"px",el.id("body").style.webkitTransform="  scale("+1/browser.scale+") translate("+device.width()*(1-browser.scale)/2+"px,"+device.height()*(1-browser.scale)/2+"px)"}null==dir?(PATH_TO_PROPERTIES=photographer_dir,STYLES_SRC=photographer_src,PUBL=!0,PUBLDOMAIN=document.referrer):("./<%=FilesFolderName%>/"==dir&&(dir="files"),PATH_TO_PROPERTIES="../"+assetsFolder+"/mobile/",PUBL=!1,PS="");var b=function(){browser.detect();preloader.init();eventManager.start();bookData.load(this.responseXML);
images.init();workspace.draw();ctrlEngine.init();pager.draw();orientationObserver.start();if(window.location.hash){var c=window.location.hash.substring(1,window.location.hash.length),c=parseInt(c);if(0>=c)c=1;else if(c>bookData.pageCount)c=bookData.pageCount;a(c);c=null}else a(1);c=el.id("mainFrame");c.style.backgroundImage=!PUBL&"image/grey-inner.jpg"!=bookData.background.src&&"image/grey-outer.jpg"!=bookData.background.src&&"image/dark-wood-inner.jpg"!=bookData.background.src&&"image/dark-wood-outer.jpg"!=
bookData.background.src&&"image/sky-blue-inner.jpg"!=bookData.background.src&&"image/sky-blue-outer.jpg"!=bookData.background.src?"url(../"+assetsFolder+"/"+bookData.background.src+")":"url("+STYLES_SRC+"background.jpg)";"single"==bookData.background.scale?(c.style.backgroundRepeat="no-repeat",c.style.backgroundPosition="center",c.style.backgroundSize="auto"):"fill"==bookData.background.scale?(c.style.backgroundRepeat="no-repeat",c.style.backgroundPosition="center",c.style.backgroundSize="cover"):
"fit"==bookData.background.scale?(c.style.backgroundRepeat="no-repeat",c.style.backgroundPosition="center",c.style.backgroundSize="contain"):"scale"==bookData.background.scale?(c.style.backgroundRepeat="no-repeat",c.style.backgroundPosition="center",c.style.backgroundSize="100% 100%"):c.style.backgroundRepeat="repeat";c=null;window.setTimeout(function(){window.scrollTo(0,1)},10);delete b};if(null===dir){var c=new XMLHttpRequest;c.open("GET",xml_dir+"properties.xml?1"+PS);c.onload=function(){var a=
new XMLHttpRequest;a.open("GET",this.responseText);a.onload=b;a.onerror=function(){document.write("Error: can`t load xml1")};a.send();delete a};c.onerror=function(){document.write("Error: can`t load xml2")}}else c=new XMLHttpRequest,c.open("GET",PATH_TO_PROPERTIES+"properties.xml"),c.onload=b,c.onerror=function(){document.write("Error: can`t load xml3")};c.send();delete c;delete main};null==dir?main():document.addEventListener("DOMContentLoaded",main,!1);
var el={id:function(a){return document.getElementById(a)},tag:function(a){return document.getElementsByTagName(a)[0]},tags:function(a){return document.getElementsByTagName(a)},add:function(a){return document.createElement(a)},del:function(a){el.id(a).parentNode.removeChild(el.id(a))},Class:function(){return document.getElementsByClassName(tag)}},onePageBook={currentPage:0,installed:!1,nextPageBuffer:2,prevPageBuffer:2,flipSpeed:600,triggerStopTime:700,bookWidth:0,bookHeight:0,bookTop:0,bookLeft:0,
padding:10,draw:function(a){preloader.stopAll();bookData.size.proportions<device.proportions()?(onePageBook.bookHeight=(device.height()-onePageBook.padding).toFixed(0),onePageBook.bookWidth=(onePageBook.bookHeight*bookData.size.proportions).toFixed(0)):(onePageBook.bookWidth=(device.width()-onePageBook.padding).toFixed(0),onePageBook.bookHeight=(onePageBook.bookWidth/bookData.size.proportions).toFixed(0));onePageBook.bookTop=((device.height()-onePageBook.bookHeight)/2).toFixed(0);onePageBook.bookLeft=
((device.width()-onePageBook.bookWidth)/2).toFixed(0);if(el.id("bookPortrait"))el.id("bookPortrait");else{var b=el.add("div");b.id="bookPortrait";crossHTML5.perspective(b,"3000");b.style.position="absolute";b.style.width=onePageBook.bookWidth+"px";b.style.height=onePageBook.bookHeight+"px";b.style.top=onePageBook.bookTop+"px";b.style.left=onePageBook.bookLeft+"px";b.style.webkitBackfaceVisibility="hidden";b.style.zIndex="2";crossHTML5.backfaceVisibility(b,"hidden");crossHTML5.boxShadow(b,"0px 0px 3px #000");
el.id("mainFrame").appendChild(b)}onePageBook.installed=!0;onePageBook.currentPage=a;pager.change();onePageBook.drawPage(this.currentPage);for(b=a-onePageBook.prevPageBuffer;b<=1*a+onePageBook.nextPageBuffer;b++)b!==this.currentPage&&onePageBook.drawPage(b)},drawPage:function(a){if(0<a&&a<=bookData.pageCount&&!el.id("canvas"+a)){var b=el.add("canvas");b.id="canvas"+a;b.className="canvasBook";b.width=onePageBook.bookWidth;b.height=onePageBook.bookHeight;b.style.position="absolute";b.style.left=a<onePageBook.currentPage?
-device.width()+"px":"";b.style.zIndex=bookData.pageCount-a+"";var c=b.getContext("2d");c.fillStyle="rgb(255,255,255)";c.fillRect(0,0,onePageBook.bookWidth,onePageBook.bookHeight);el.id("bookPortrait").appendChild(b);bookData.page[a].stub||(images.push(a),preloader.add(a))}},destroyPage:function(a){el.id("canvas"+a)&&el.del("canvas"+a);preloader.deletePreloader(a)},next:function(){if(zoomLock.check()&&onePageBook.installed&&onePageBook.currentPage<bookData.pageCount&&timer.check("fx")){onePageBook.slideFxPage(onePageBook.currentPage);
if(5==el.id("bookPortrait").childNodes.length){var a=onePageBook.currentPage-onePageBook.prevPageBuffer;images.deleteImageFromStack(a);onePageBook.destroyPage(a);delete bm.rasterize.imgData[a];preloader.deletePreloader(a);window.scrollTo(0,1)}onePageBook.currentPage++;onePageBook.drawPage(1*onePageBook.currentPage+1*onePageBook.nextPageBuffer);pager.change();timer.setBlockTime(twoPageBook.flipSpeed/2,twoPageBook.flipSpeed)}},prev:function(){if(zoomLock.check()&&onePageBook.installed&&1<onePageBook.currentPage&&
timer.check("fx")){onePageBook.slideFxPage(onePageBook.currentPage-1);if(5==el.id("bookPortrait").childNodes.length){var a=1*onePageBook.currentPage+1*onePageBook.nextPageBuffer;images.deleteImageFromStack(a);onePageBook.destroyPage(a);delete bm.rasterize.imgData[a];window.scrollTo(0,1)}onePageBook.currentPage--;onePageBook.drawPage(onePageBook.currentPage-onePageBook.prevPageBuffer);pager.change();timer.setBlockTime(twoPageBook.flipSpeed/2,twoPageBook.flipSpeed)}},slideFxPage:function(a){if(a<onePageBook.currentPage)var b=
2*onePageBook.bookLeft+1*onePageBook.bookWidth;else a==onePageBook.currentPage&&(b=0-(2*onePageBook.bookLeft+1*onePageBook.bookWidth));a=el.id("canvas"+a);crossHTML5.transitionDuration(a,onePageBook.flipSpeed+"ms");""===crossHTML5.transform(a)||"translateX(0px)"===crossHTML5.transform(a)||"translate3d(0px, 0px, 0px)"===crossHTML5.transform(a)?crossHTML5.transform(a,"translate3d("+(b-1)+"px, 0px,0px)","translateX("+b+"px)"):crossHTML5.transform(a,"translate3d(0px, 0px,0px)","translateX(0px)")},goToPage:function(a){if(0>
a)a=1;else if(a>bookData.pageCount)a=bookData.pageCount;if(a==onePageBook.currentPage)pageMediator.change();else if(a==1*onePageBook.currentPage+1)onePageBook.next();else if(a==1*onePageBook.currentPage-1)onePageBook.prev();else if(0<a&&a<=bookData.pageCount&&zoomLock.check()&&timer.check("fx")){if(1*a>1*onePageBook.currentPage)var b=1*onePageBook.currentPage+1,c=onePageBook.currentPage;else c=b=onePageBook.currentPage-1;bm.rasterize.imgData={};var d=el.id("canvas"+b).getContext("2d");d.fillStyle=
"rgb(255,255,255)";d.fillRect(0,0,onePageBook.bookWidth,onePageBook.bookHeight);preloader.add(b);preloader.setSpecial(b);this.slideFxPage(c);this.currentPage=a;pager.change();var e=function(){onePageBook.destroy();onePageBook.draw(a);window.scrollTo(0,1);delete e},d=null;window.setTimeout(e,onePageBook.flipSpeed);b=c=null}},destroyOtherPages:function(){for(var a=1*onePageBook.currentPage+1*onePageBook.nextPageBuffer,b=onePageBook.currentPage-onePageBook.prevPageBuffer;b<=a;b++)b!=onePageBook.currentPage&&
0<b&&b<=bookData.pageCount&&el.del("canvas"+b)},goToZoom:function(){if(zoomLock.check()){this.destroyOtherPages();var a=screen.height/onePageBook.bookWidth;if("iPad"!=device.name()||"other"!=device.name)a*=1.4;var b=el.id("canvas"+onePageBook.currentPage);if(b.style.left||"0px"==b.style.left)crossHTML5.transitionDuration(b,"0ms"),crossHTML5.transform(b,"translate3d(0px, 0px,0px)","translate(0px, 0px)"),b.style.left="0px";window.setTimeout(function(){crossHTML5.transitionDuration(b,zoomBook.zoomIOSpeed+
"ms");crossHTML5.transform(b,"scale3d("+a+","+a+",1)","scale("+a+")")},1);var c=function(){el.id("canvas"+onePageBook.currentPage).id="zoomedPage";zoomBook.draw(onePageBook.currentPage,a);delete c};window.setTimeout(c,zoomBook.zoomIOSpeed+10)}},gestureZoom:function(a){if(zoomLock.check()){var b=el.id("canvas"+onePageBook.currentPage);if(b.style.left||"0px"==b.style.left)crossHTML5.transitionDuration(b,"0ms"),crossHTML5.transform(b,"translate3d(0px, 0px,0px)","translate(0px, 0px)"),b.style.left="0px";
crossHTML5.transitionDuration(b,"0ms");crossHTML5.transform(b,"scale3d("+(1+(a.scale-1)/3)+","+(1+(a.scale-1)/3)+","+(1+(a.scale-1)/3)+")","scale("+(1+(a.scale-1)/3)+")")}},gestureStop:function(a){if(zoomLock.check()){var b=el.id("canvas"+onePageBook.currentPage),a=1+(a.scale-1)/3,c=Math.sqrt(5E6/(this.pageWidth*this.pageHeight));if(a>c){if(b.style.left||"0px"==b.style.left)crossHTML5.transitionDuration(b,"0ms"),crossHTML5.transform(b,"translate3d(0px, 0px,0px)","translate(0px, 0px)"),b.style.left=
"0px";crossHTML5.transitionDuration(b,"300ms");crossHTML5.transform(b,"scale3d("+c+","+c+","+c+")","scale(3)");b.id="zoomedPage";zoomBook.draw(onePageBook.currentPage,3)}else 1.2>a?(b.style.webkitTransitionDuration="200ms",b.style.webkitTransform=""):(b.id="zoomedPage",zoomBook.draw(onePageBook.currentPage,a));zoomFacrot=null}},destroy:function(){preloader.stopAll();el.del("bookPortrait");onePageBook.installed=!1}};
onePageBook.events={tapCount:0,clickCount:0,doubleTapTime:250,doubleClickTime:250,leftAndRightArea:0.15,gestureX:0,gestureY:0,touchCancel:!1,gestureTarget:0,touchStart:function(a){"CANVAS"==a.target.tagName&&links.drawRect(a)},touchMove:function(a){if(links.isLinkBool){var b=a.targetTouches[0].pageY-eventManager.touchStartCoordinate.y;(10<Math.abs(a.targetTouches[0].pageX-eventManager.touchStartCoordinate.x)||10<Math.abs(b))&&links.clearRect()}delete a},touchEnd:function(a){!zoomBook.installed&&!eventManager.gesture&&
(-50>eventManager.touchStartCoordinate.x-a.changedTouches[0].pageX?onePageBook.events.flipRight():50<eventManager.touchStartCoordinate.x-a.changedTouches[0].pageX?onePageBook.events.flipLeft():onePageBook.events.touchManger(a))},touchCancel:function(){links.isLinkBool&&links.clearRect()},gestureStart:function(a){this.gestureTarget=a.target},gestureChange:function(a){onePageBook.gestureZoom(a)},gestureEnd:function(a){onePageBook.gestureStop(a)},touchManger:function(a){if(links.isLinkBool&&links.currURLs){if(links.clearRect(),
links.currURLs)for(var b=0;b<links.currURLs.length;b++)window.open(links.currURLs[b])}else if(onePageBook.events.tapCount++,1==onePageBook.events.tapCount){var c=function(){if(1==onePageBook.events.tapCount)onePageBook.events.singleTap(a),onePageBook.events.tapCount=0;delete c};window.setTimeout(c,onePageBook.events.doubleTapTime)}else onePageBook.events.doubleTap(a),onePageBook.events.tapCount=0},mousedown:function(a){"CANVAS"==a.target.tagName&&links.drawRect(a)},mouseup:function(a){if(!zoomBook.installed){var b=
browser.publisher.isOn?a.pageX/1.3:a.pageX;-50>eventManager.clickStartCoordinate.x-b?onePageBook.events.flipRight():50<eventManager.clickStartCoordinate.x-b?onePageBook.events.flipLeft():onePageBook.events.clickManger(a)}},mousemove:function(a){if(links.isLinkBool){var b=a.pageY-eventManager.clickStartCoordinate.y;(10<Math.abs(a.pageX-eventManager.clickStartCoordinate.x)||10<Math.abs(b))&&links.clearRect()}delete a},clickManger:function(a){if(links.isLinkBool&&links.currURLs){if(links.clearRect(),
links.currURLs)for(var b=0;b<links.currURLs.length;b++)window.open(links.currURLs[b])}else if(onePageBook.events.clickCount++,1==onePageBook.events.clickCount){var c=function(){if(1==onePageBook.events.clickCount)onePageBook.events.singleClick(a),onePageBook.events.clickCount=0;delete c};window.setTimeout(c,onePageBook.events.doubleClickTime)}else onePageBook.events.doubleClick(a),onePageBook.events.clickCount=0},singleTap:function(a){links.isLinkBool?(links.clearRect(),links.currGoPage&&onePageBook.goToPage(links.currGoPage)):
a.changedTouches[0].pageX<device.width()*onePageBook.events.leftAndRightArea?onePageBook.prev():a.changedTouches[0].pageX>device.width()-device.width()*onePageBook.events.leftAndRightArea?onePageBook.next():toolbar.toogle();delete a},doubleTap:function(){links.isLinkBool&&links.clearRect();onePageBook.goToZoom()},singleClick:function(a){if(links.isLinkBool){if(links.clearRect(),links.currGoPage&&onePageBook.goToPage(links.currGoPage),links.currURLs)for(a=0;a<links.currURLs.length;a++)window.open(links.currURLs[a])}else a.x<
device.width()*onePageBook.events.leftAndRightArea?onePageBook.prev():a.x>device.width()-device.width()*onePageBook.events.leftAndRightArea?onePageBook.next():toolbar.toogle(),delete a},doubleClick:function(){links.isLinkBool&&links.clearRect();onePageBook.goToZoom()},flipLeft:function(){onePageBook.next()},flipRight:function(){onePageBook.prev()}};
var orientationObserver={start:function(){if(browser.publisher.isOn)return browser.publisher.orientation;if(browser.platform.android){PUBL||window.addEventListener("resize",workspace.reDraw,!1);var a=function(){onePageBook.installed&&(onePageBook.destroy(),onePageBook.draw(onePageBook.currentPage));delete a};PUBL||window.addEventListener("resize",a,!1)}else PUBL||window.addEventListener("orientationchange",workspace.reDraw,!1),a=function(){if("iPad"==device.name())if("portrait"==orientationObserver.getOrientation()){if(twoPageBook.installed){var b=
pageMediator.getPage();twoPageBook.destroy();onePageBook.draw(b)}}else"landscape"==orientationObserver.getOrientation()&&onePageBook.installed&&(onePageBook.destroy(),twoPageBook.draw(onePageBook.currentPage));else onePageBook.installed&&(onePageBook.destroy(),onePageBook.draw(onePageBook.currentPage));delete a},PUBL||window.addEventListener("orientationchange",a,!1)},stop:function(){browser.platform.android?window.removeEventListener("resize",workspace.reDraw,!1):window.removeEventListener("orientationchange",
workspace.reDraw,!1)},getOrientation:function(){if(browser.publisher.isOn)return browser.publisher.orientation;if(browser.platform.android||PUBL){if(window.innerWidth>window.innerHeight)return"landscape";if(window.innerWidth<window.innerHeight)return"portrait"}else{if(0===Math.abs(window.orientation)||180===Math.abs(window.orientation))return"portrait";if(90===Math.abs(window.orientation))return"landscape"}}},pageMediator={next:function(){"unlock"==slideShow.state&&(onePageBook.installed&&!zoomBook.installed?
(onePageBook.next(),ctrlEngine.hide()):twoPageBook.installed&&!zoomBook.installed?twoPageBook.next():zoomBook.installed&&zoomBook.next())},prev:function(){"unlock"==slideShow.state&&(onePageBook.installed&&!zoomBook.installed?(onePageBook.prev(),ctrlEngine.hide()):twoPageBook.installed&&!zoomBook.installed?twoPageBook.prev():zoomBook.installed&&zoomBook.prev())},change:function(){"unlock"==slideShow.state&&(pager.change(),twoPageBook.installed&&twoPageBook.shadow.reDraw())},goToPage:function(a){onePageBook.installed&&
!zoomBook.installed?(onePageBook.goToPage(a),!1==toc.tocLock&&ctrlEngine.hide(),toc.tocLock=!1):twoPageBook.installed&&!zoomBook.installed?twoPageBook.goToPage(a):zoomBook.installed&&zoomBook.goToPage(a)},getPage:function(a){a=a||"left";if(onePageBook.installed)return onePageBook.currentPage;if(zoomBook.installed)return zoomBook.currentPage;if(twoPageBook.installed)return 1==1*twoPageBook.currentPage.right?twoPageBook.currentPage.right:pageMediator.isLastPage(twoPageBook.currentPage.left)?twoPageBook.currentPage.left:
pageMediator.isLastPage(twoPageBook.currentPage.right)?twoPageBook.currentPage.right:"left"===a?twoPageBook.currentPage.left:twoPageBook.currentPage.right},getCurrentPage:function(){if(onePageBook.installed)return onePageBook.currentPage;if(zoomBook.installed)return zoomBook.currentPage;if(twoPageBook.installed)return twoPageBook.currentPage},isLastPage:function(){return onePageBook.installed&&bookData.pageCount===onePageBook.currentPage?!0:zoomBook.installed&&bookData.pageCount===zoomBook.currentPage?
!0:twoPageBook.installed&&(twoPageBook.currentPage.right===bookData.pageCount||twoPageBook.currentPage.right>bookData.pageCount)?!0:!1}},pager={installed:!1,state:"show",fontSize:14,fontMarginTop:10,fontMarginLeft:10,draw:function(){if(el.id("pagerToolbar")){if(!pager.installed){var a=el.add("span");a.className="pagerField";a.id="pagerField";el.id("pagerToolbar").appendChild(a);pager.event(a);var b=el.add("span");b.className="pagerFont";b.style.margin=pager.fontMarginTop+"px "+pager.fontMarginLeft+
"px";b.style.fontSize=pager.fontSize+"px";b.appendChild(document.createTextNode("Page  "));a.appendChild(b);b=el.add("span");b.id="pagerCurrentPage";b.className="pagerFont";b.style.margin=pager.fontMarginTop+"px 0 0 0";b.style.fontSize=pager.fontSize+"px";b.innerHTML="0";a.appendChild(b);b=el.add("span");b.className="pagerFont";b.style.margin=pager.fontMarginTop+"px "+pager.fontMarginLeft+"px";b.style.fontSize=pager.fontSize+"px";b.appendChild(document.createTextNode(" / "+bookData.pageCount));a.appendChild(b)}pager.installed=
!0}},change:function(){buttons.check();if(el.id("pagerToolbar")){window.scrollTo(0,1);"input"==pager.state&&pager.cancelInput();if(onePageBook.installed&&!zoomBook.installed){var a=el.id("pagerCurrentPage");a.removeChild(a.childNodes[0]);nTe=document.createTextNode(onePageBook.currentPage);a.appendChild(nTe);window.location.hash="#"+onePageBook.currentPage}else if(twoPageBook.installed&&!zoomBook.installed)if(0<twoPageBook.currentPage.left&&twoPageBook.currentPage.right<=bookData.pageCount)a=el.id("pagerCurrentPage"),
a.removeChild(a.childNodes[0]),nTe=document.createTextNode(twoPageBook.currentPage.left+"-"+twoPageBook.currentPage.right),a.appendChild(nTe),window.location.hash="#"+twoPageBook.currentPage.left;else if(0>=twoPageBook.currentPage.left)a=el.id("pagerCurrentPage"),a.removeChild(a.childNodes[0]),nTe=document.createTextNode(twoPageBook.currentPage.right),a.appendChild(nTe),window.location.hash="#"+twoPageBook.currentPage.right;else{if(twoPageBook.currentPage.right>bookData.pageCount)a=el.id("pagerCurrentPage"),
a.removeChild(a.childNodes[0]),nTe=document.createTextNode(twoPageBook.currentPage.left),a.appendChild(nTe),window.location.hash="#"+twoPageBook.currentPage.left}else if(zoomBook.installed)a=el.id("pagerCurrentPage"),a.removeChild(a.childNodes[0]),nTe=document.createTextNode(zoomBook.currentPage),a.appendChild(nTe),window.location.hash="#"+zoomBook.currentPage;if(PUBL)parent.window.location=PUBLDOMAIN+window.location.hash}},enableInput:function(a){if("unlock"==slideShow.state){a.target=a.target?a.target:
a.srcElement;a.preventDefault();pager.state="input";a=el.add("input");a.className="inputPage";a.id="inputPage";a.type="number";a.style.height=pager.fontSize+"px";a.style.width="100px";a.style.fontSize=pager.fontSize-1+"px";a.style.margin=pager.fontMarginTop+"px "+pager.fontMarginLeft+"px";a.value=pageMediator.getPage();if(el.id("pagerCurrentPage")){var b=el.id("pagerCurrentPage");b.parentNode.replaceChild(a,b)}pager.inputEvent(a);a.focus();a.select()}},cancelInput:function(){var a=el.add("span");
a.id="pagerCurrentPage";a.className="pagerFont";a.style.margin=pager.fontMarginTop+"px 0 0 0";a.style.fontSize=pager.fontSize+"px";if(onePageBook.installed)var b=onePageBook.currentPage;else twoPageBook.installed?(b="",0<twoPageBook.currentPage.left&&twoPageBook.currentPage.left<=bookData.pageCount&&(b=b+twoPageBook.currentPage.left+"-"),0<twoPageBook.currentPage.right&&twoPageBook.currentPage.right<=bookData.pageCount&&(b+=twoPageBook.currentPage.right)):b=zoomBook.installed?zoomBook.currentPage:
"0";b=document.createTextNode(b);a.appendChild(b);a.addEventListener("click",pager.enableInput);b=el.id("inputPage");b.parentNode.replaceChild(a,b);pager.state="show"},event:function(a){event.preventDefault();a.addEventListener("click",pager.enableInput,!1)},inputEvent:function(a){event.preventDefault();if(pager.installed&&"input"==pager.state&&"unlock"==slideShow.state){var b=function(a){a.target=a.target?a.target:a.srcElement;13==a.keyCode&&(pager.change(),pageMediator.goToPage(a.target.value));
delete b};a.addEventListener("keydown",b,!1)}a=null}},preloader={image:new Image,interval:null,preloadersStack:[],imageLoad:!1,angle:0,special:0,init:function(){this.image.src=null===dir?preloader_img:STYLES_SRC+"progress.png";this.image.onload=function(){preloader.imageLoad=!0;if(0<preloader.preloadersStack.length){for(var a=0;a<preloader.preloadersStack.length;a++){var b=el.id("canvas"+preloader.preloadersStack[a]);preloader.draw(b);var c=b.getContext("2d");c.save();c.translate(b.width/2,b.height/
2);c.drawImage(preloader.image,-20,-20,40,40);c.restore()}preloader.startInterval()}}},draw:function(a){var b=a.getContext("2d");b.save();b.translate(a.width/2,a.height/2);b.drawImage(preloader.image,-20,-20,40,40);b.strokeRect(-20,-20,40,40);b.restore()},add:function(a){a*=1;el.id("canvas"+a)&&(preloader.imageLoad&&preloader.draw(el.id("canvas"+a),a),this.preloadersStack.push(1*a),1==preloader.preloadersStack.length&&preloader.imageLoad&&preloader.startInterval())},setSpecial:function(a){psNum=1*
a;preloader.special=a},draw:function(a){var b=a.getContext("2d");b.save();b.translate(a.width/2,a.height/2);b.drawImage(preloader.image,-20,-20,40,40);b.restore()},startInterval:function(){clearInterval(preloader.interval);var a=function(){var b,c;0==preloader.preloadersStack.length&&preloader.stopInterval();preloader.angle+=6;if(360==preloader.angle)preloader.angle=0;if(onePageBook.installed)c=b=onePageBook.currentPage;else if(twoPageBook.installed)b=twoPageBook.currentPage.left,c=twoPageBook.currentPage.right;
else if(zoomBook.installed)c=b=zoomBook.currentPage;for(var d=0;d<preloader.preloadersStack.length;d++)if(preloader.preloadersStack[d]==b||preloader.preloadersStack[d]==c||preloader.preloadersStack[d]==preloader.special){var e=el.id("canvas"+preloader.preloadersStack[d]),f=e.getContext("2d");f.save();f.translate(e.width/2,e.height/2);f.rotate(preloader.angle*(Math.PI/180));f.fillStyle="rgb(255,255,255)";f.fillRect(-30,-30,60,60);f.drawImage(preloader.image,-20,-20,40,40);f.restore()}delete a};preloader.interval=
window.setInterval(a,45)},stopInterval:function(){clearInterval(preloader.interval)},deletePreloader:function(a){var a=1*a,b=preloader.preloadersStack.indexOf(1*a);if(el.id("canvas"+a)){var a=el.id("canvas"+a),c=a.getContext("2d");c.save();c.translate(a.width/2,a.height/2);c.fillStyle="rgb(255,255,255)";c.fillRect(-30,-30,60,60);c.restore()}-1!=b&&(preloader.preloadersStack.splice(b,1),0==preloader.preloadersStack.length&&preloader.stopInterval())},stopAll:function(){preloader.preloadersStack=[]},
insertSimpleLoader:function(a,b,c){var d=el.add("img"),d=this.image;d.id="simpleLoader";d.style.zIndex=1E3;d.className="preloaderZ";d.style.left=b+"px";d.style.top=c+"px";crossHTML5.transform(d,"translate3d(0px, 0px, 10px)","translate(0px, 0px)");a.appendChild(d)},delSimplePreloader:function(){el.del("simpleLoader")}},skin=function(){bookData.skinScale="android"==device.name()?1.7:1;bookData.toolbar={};bookData.toolbar[0]={};bookData.toolbar[0].id="navigationToolbar";bookData.toolbar[0].orientation=
"bottom";bookData.toolbar[0].className="navigationToolbar";bookData.toolbar[0].height=40*bookData.skinScale;bookData.toolbar[0].width="100%";bookData.toolbar[0].bottom=20*bookData.skinScale;bookData.toolbar[0].left=0;bookData.toolbar[0].speed="0.3s";bookData.toolbar[1]={};bookData.toolbar[1].id="leftToolbar";bookData.toolbar[1].orientation="left";bookData.toolbar[1].className="leftToolbar";bookData.toolbar[1].height="100%";bookData.toolbar[1].width=40*bookData.skinScale;bookData.toolbar[1].bottom=
0;bookData.toolbar[1].top=0;bookData.toolbar[1].left=0;bookData.toolbar[1].speed="0.3s";bookData.toolbar[2]={};bookData.toolbar[2].id="rightToolbar";bookData.toolbar[2].orientation="right";bookData.toolbar[2].className="rightToolbar";bookData.toolbar[2].height="100%";bookData.toolbar[2].width=40*bookData.skinScale;bookData.toolbar[2].bottom=0;bookData.toolbar[2].top=29;bookData.toolbar[2].right=0;bookData.toolbar[2].speed="0.3s";bookData.toolbar[3]={};bookData.toolbar[3].id="pagerToolbar";bookData.toolbar[3].orientation=
"top";bookData.toolbar[3].className="pagerToolbar";bookData.toolbar[3].height=30*bookData.skinScale;bookData.toolbar[3].top=0;bookData.toolbar[3].right=-1;bookData.toolbar[3].speed="0.3s";pager.fontSize=14*bookData.skinScale;pager.fontMarginTop=8*bookData.skinScale;pager.fontMarginLeft=8*bookData.skinScale;bookData.toolbar[4]={};bookData.toolbar[4].id="infoToolbar";bookData.toolbar[4].orientation="top";bookData.toolbar[4].className="infoToolbar";bookData.toolbar[4].height=0;bookData.toolbar[4].top=
0;bookData.toolbar[4].left=0;bookData.toolbar[4].speed="0s";ctrlEngine.border.orientation="top";ctrlEngine.border.top=0;ctrlEngine.border.left=40*bookData.skinScale;ctrlEngine.border.right=40*bookData.skinScale;ctrlEngine.border.bottom=80*bookData.skinScale;ctrlEngine.border.speed="0.3s";ctrlEngine.border.isFx=!0;ctrlEngine.border.wMain=350;ctrlEngine.border.wInfo=450;ctrlEngine.border.hHeader=40;ctrlEngine.border.margin=5;buttons.fieldWidth=40*bookData.skinScale;buttons.fieldHeight=36*bookData.skinScale;
buttons.info.width=25*bookData.skinScale;buttons.info.height=25*bookData.skinScale;buttons.info.margin=bookData.toolbar[2].width-buttons.info.width;buttons.info.imgWidth=buttons.info.width;buttons.info.imgHeight=buttons.info.height;buttons.navigation.parentNodeId=bookData.toolbar[0].id;buttons.navigation.height=20*bookData.skinScale;buttons.navigation.margin=10*bookData.skinScale;buttons.slideShow.parentNodeId="navigationField";buttons.slideShow.en=bookData.slideShowVisible;buttons.bgImg="#000";buttons.bgImgOnclick=
"#555";buttons.toc.parentNodeId=bookData.toolbar[1].id;buttons.toc.src=STYLES_SRC+"buttons/toc.png";buttons.toc.height=30*bookData.skinScale;buttons.toc.width=30*bookData.skinScale;buttons.toc.marginTop=(buttons.fieldHeight-buttons.toc.height)/2;buttons.toc.marginLeft=(buttons.fieldWidth-buttons.toc.width)/2;buttons.bm.parentNodeId=bookData.toolbar[1].id;buttons.bm.src=STYLES_SRC+"buttons/bm.png";buttons.bm.height=30*bookData.skinScale;buttons.bm.width=30*bookData.skinScale;buttons.bm.marginTop=(buttons.fieldHeight-
buttons.bm.height)/2;buttons.bm.marginLeft=(buttons.fieldWidth-buttons.bm.width)/2;buttons.addBm.parentNodeId=bookData.toolbar[2].id;buttons.addBm.srcAdd=STYLES_SRC+"buttons/addbm.png";buttons.addBm.srcRem=STYLES_SRC+"buttons/rembm.png";buttons.addBm.height=30*bookData.skinScale;buttons.addBm.width=30*bookData.skinScale;buttons.addBm.marginTop=(buttons.fieldHeight-buttons.addBm.height)/2;buttons.addBm.marginLeft=(buttons.fieldWidth-buttons.addBm.width)/2;buttons.search.parentNodeId=bookData.toolbar[2].id;
buttons.search.src=STYLES_SRC+"buttons/search.png";buttons.search.en=bookData.searchVisible;buttons.search.height=30*bookData.skinScale;buttons.search.width=30*bookData.skinScale;buttons.search.marginTop=(buttons.fieldHeight-buttons.search.height)/2;buttons.search.marginLeft=(buttons.fieldWidth-buttons.search.width)/2;buttons.info.parentNodeId=bookData.toolbar[2].id;buttons.info.src=STYLES_SRC+"buttons/info.png";buttons.back.color="#ccc";buttons.back.colorOn="#000";bookData.info={};bookData.info.gestures=
{};bookData.info.gestures[0]={};bookData.info.gestures[0].src=STYLES_SRC+"info/slide.png";bookData.info.gestures[0].h1="Slide:";bookData.info.gestures[0].p="Flip pages to the left / to the right";bookData.info.gestures[1]={};bookData.info.gestures[1].src=STYLES_SRC+"info/singletapside.png";bookData.info.gestures[1].h1="Single Tap (side):";bookData.info.gestures[1].p="Flip pages to the left / to the right";bookData.info.gestures[2]={};bookData.info.gestures[2].src=STYLES_SRC+"info/singletapcenter.png";
bookData.info.gestures[2].h1="Single Tap (center):";bookData.info.gestures[2].p="Show / hide on-screen control toolbar";bookData.info.gestures[3]={};bookData.info.gestures[3].src=STYLES_SRC+"info/doubletap.png";bookData.info.gestures[3].h1="Double Tap:";bookData.info.gestures[3].p="Zoom in / zoom out";bookData.info.gestures[4]={};bookData.info.gestures[4].src=STYLES_SRC+"info/pinch.png";bookData.info.gestures[4].h1="Pinch:";bookData.info.gestures[4].p="Zoom in / zoom out";bookData.info.gestures[5]=
{};bookData.info.gestures[5].src=STYLES_SRC+"info/move.png";bookData.info.gestures[5].h1="Move:";bookData.info.gestures[5].p="Move page in zoom mode";bookData.info.gestures[6]={};bookData.info.gestures[6].src=STYLES_SRC+"info/rotate.png";bookData.info.gestures[6].h1="Rotate:";bookData.info.gestures[6].p="Change device orientation";bookData.info.toolbar={};var a=0;if(bookData.tocVisible)bookData.info.toolbar[a]={},bookData.info.toolbar[a].src=STYLES_SRC+"buttons/toc.png",bookData.info.toolbar[a].p=
"View Table of Contents",a+=1;if(bookData.bookmarksVisible)bookData.info.toolbar[a]={},bookData.info.toolbar[a].src=STYLES_SRC+"buttons/bm.png",bookData.info.toolbar[a].p="View Bookmark List",a+=1,bookData.info.toolbar[a]={},bookData.info.toolbar[a].src=STYLES_SRC+"buttons/addbm.png",bookData.info.toolbar[a].p="Add/remove Bookmark",a+=1;if(bookData.searchVisible)bookData.info.toolbar[a]={},bookData.info.toolbar[a].src=STYLES_SRC+"buttons/search.png",bookData.info.toolbar[a].p="Search by kayword";
bookData.info.navigation={};a=0;if(bookData.slideshowVisible&&bookData.navigationVisible)bookData.info.navigation[a]={},bookData.info.navigation[a].src=STYLES_SRC+"navigation/activeslideshow.png",bookData.info.navigation[a].p="Start/stop Slide Show",a+=1;if(bookData.navigationVisible)bookData.info.navigation[a]={},bookData.info.navigation[a].src=STYLES_SRC+"navigation/activenext.png",bookData.info.navigation[a].p="Flip to Next Page",a+=1,bookData.info.navigation[a]={},bookData.info.navigation[a].src=
STYLES_SRC+"navigation/activeprev.png",bookData.info.navigation[a].p="Flip to Previose Page",a+=1,bookData.info.navigation[a]={},bookData.info.navigation[a].src=STYLES_SRC+"navigation/activelast.png",bookData.info.navigation[a].p="Flip to Last Page",a+=1,bookData.info.navigation[a]={},bookData.info.navigation[a].src=STYLES_SRC+"navigation/activefirst.png",bookData.info.navigation[a].p="Flip to First Page"},slideShow={interval:null,state:"unlock",play:function(){slideShow.state="lock";slideShow.interval=
window.setInterval(function(){if(onePageBook.installed)var a=onePageBook.currentPage;else if(twoPageBook.installed){if(a="",0<twoPageBook.currentPage.left&&twoPageBook.currentPage.left<=bookData.pageCount&&(a=a+twoPageBook.currentPage.left+"-"),0<twoPageBook.currentPage.right&&twoPageBook.currentPage.right<=bookData.pageCount&&(a+=twoPageBook.currentPage.right),twoPageBook.currentPage.left==bookData.pageCount||twoPageBook.currentPage.right==bookData.pageCount)a=bookData.pageCount}else a="0";a==bookData.pageCount?
pageMediator.goToPage(1):slideShow.next();pager.change()},2E3);"display"==ctrlEngine.state&&ctrlEngine.hide()},next:function(){zoomBook.installed||(onePageBook.installed?onePageBook.next():twoPageBook.installed&&twoPageBook.next())},stop:function(){slideShow.state="unlock";clearInterval(slideShow.interval)},toGo:function(){"lock"==slideShow.state?slideShow.stop():"unlock"==slideShow.state&&slideShow.play()}};
timer={state:!0,blockTime:0,endFX:0,startTime:Date.now(),setBlockTime:function(a,b){this.endFX=b||a;this.blockTime=a;this.startTime=Date.now()},check:function(a){a=a||"standart";if("standart"==a)return Date.now()-this.startTime>this.blockTime?!0:!1;if("high"==a)return!0;if("fx"==a)return Date.now()-this.startTime>this.endFX?!0:!1}};
var toc={installed:!1,isToc:!1,mark:0,pageNum:0,level:[],tocLock:!1,shiftSpeed:500,parseLevel:function(a){var b;for(i=0;i<a;i++)b=0==i?bookData.TOC:b.tocElement[toc.level[i]].children;return b},init:function(){if(!toc.installed){if(bookData.TOC)toc.isToc=!0;toc.installed=!0}},showFirstMenu:function(){if(toc.isToc)if("hide"==ctrlEngine.state)ctrlEngine.mode="toc",toc.level=[],toc.level[0]=0,ctrlEngine.display();else if("toc"==ctrlEngine.mode)ctrlEngine.hide(),toc.level=[];else if("bm"==ctrlEngine.mode)ctrlEngine.mode=
"toc",toc.level=[],toc.level[0]=0,ctrlEngine.change()},showPrevMenu:function(){var a=toc.level.length;toc.mark=toc.level[a-1];if(1<a){if(3<=a){var b=toc.parseLevel(a-2);ctrlEngine.content.generateList.toc(b,a-3,!1);var b=el.id("Menu"+(a-3)),c=b.getElementsByTagName("LI")[toc.level[a-2]-1],d=el.id("Content"),e=d.offsetHeight/(3*c.offsetHeight);if(toc.level[a-2]>e&&0>d.offsetHeight-b.offsetHeight)b.style.top=(e.toFixed()-toc.level[a-2])*c.offsetHeight<d.offsetHeight-b.offsetHeight?d.offsetHeight-b.offsetHeight+
"px":(e.toFixed()-toc.level[a-2])*c.offsetHeight+"px";c.style.background="#888888";b=b=c=e=d=null}ctrlEngine.content.leftShift(a-2);var f=function(){ctrlEngine.content.remove(toc.level.length);delete f};window.setTimeout(f,toc.shiftSpeed+50);toc.level=toc.level.slice(0,a-1);buttons.back.check();event=null}a=null}},toolbar={status:"hide",installed:!1,draw:function(){if(!toolbar.installed){skin();for(tb in bookData.toolbar){tb=bookData.toolbar[tb];var a=el.add("div");a.className=tb.className;a.id=tb.id;
a.style.height="100%"!=tb.height?tb.height+"px":tb.height;a.style.width="100%"!=tb.width?tb.width+"px":tb.width;if(tb.top)a.style.top=tb.top+"px";if(tb.left)a.style.left=tb.left+"px";if(tb.right)a.style.right=tb.right+"px";if(tb.bottom)a.style.bottom=tb.bottom+"px";toolbar.backShift(a,tb);el.id("body").appendChild(a);buttons.navigation.parentNodeId==tb.id&&buttons.navigation.draw(a);buttons.slideShow.parentNodeId==tb.id&&"true"==bookData.slideshowVisible&&buttons.slideShow.draw(a);buttons.search.parentNodeId==
tb.id&&buttons.search.en&&buttons.search.draw(a);buttons.addBm.parentNodeId==tb.id&&buttons.addBm.draw(a);buttons.info.parentNodeId==tb.id&&buttons.info.draw(a);buttons.toc.parentNodeId==tb.id&&buttons.toc.draw(a);buttons.bm.parentNodeId==tb.id&&buttons.bm.draw(a);a.addEventListener("touchmove",buttons.lockMove);if(!toolbar.installed)toolbar.installed=!0}tb=null}},backShift:function(a,b){if("top"==b.orientation)a.style.top=-10-b.height+"px";if("bottom"==b.orientation)a.style.bottom=-10-b.height+"px";
if("left"==b.orientation)a.style.left=-10-b.width+"px";if("right"==b.orientation)a.style.right=-10-b.width+"px"},toogle:function(){if(toolbar.installed){"input"==pager.state&&pager.cancelInput();if("show"==this.status){for(tb in bookData.toolbar)tb=bookData.toolbar[tb],toolbar.transform(tb,0);toolbar.status="hide";ctrlEngine.hide()}else{for(tb in bookData.toolbar)tb=bookData.toolbar[tb],toolbar.transform(tb,-1);toolbar.status="show"}tb=null}},transform:function(a,b){var c=0,d=el.id(a.id);"top"==a.orientation&&
(c=-(a.height+a.top+9)*b-10*(b+1),crossHTML5.transitionDuration(d,a.speed),crossHTML5.transform(d,"translate3d(0px,"+c+"px,100px)","translateY("+c+"px) translateZ(100px)"));"bottom"==a.orientation&&(c=(a.height+a.bottom+9)*b+10*(b+1),crossHTML5.transitionDuration(d,a.speed),crossHTML5.transform(d,"translate3d(0px,"+c+"px,100px)","translateY("+c+"px) translateZ(100px)"));"left"==a.orientation&&(c=-(a.width+a.left+9)*b-10*(b+1),crossHTML5.transitionDuration(d,a.speed),crossHTML5.transform(d,"translate3d("+
c+"px,0px,100px)","translateX("+c+"px) translateZ(100px)"));"right"==a.orientation&&(c=(a.width+a.right+9)*b+10*(b+1),crossHTML5.transitionDuration(d,a.speed),crossHTML5.transform(d,"translate3d("+c+"px,0px,100px)","translateX("+c+"px) translateZ(100px)"))}},twoPageBook={currentPage:{left:0,right:0},installed:!1,nextPageBuffer:2,prevPageBuffer:2,flipSpeed:800,triggerStopTime:850,bookWidth:0,bookHeight:0,bookTop:0,bookLeft:0,padding:10,gestureStore:{left:"",webkit:"",zIndex:"",parent:""},pageConverter:function(a){0!=
a%2?(twoPageBook.currentPage.left=a-1,twoPageBook.currentPage.right=a):(twoPageBook.currentPage.left=a,twoPageBook.currentPage.right=1*a+1);twoPageBook.currentPage.left*=1;twoPageBook.currentPage.right*=1},draw:function(a){preloader.stopAll();twoPageBook.pageConverter(a);2*bookData.size.proportions<device.proportions()?(twoPageBook.bookWidth=((device.height()-twoPageBook.padding)*2*bookData.size.proportions).toFixed(0),twoPageBook.bookHeight=(device.height()-twoPageBook.padding).toFixed(0)):(twoPageBook.bookWidth=
device.width()-twoPageBook.padding,twoPageBook.bookHeight=((device.width()-twoPageBook.padding)/(2*bookData.size.proportions)).toFixed(0));twoPageBook.bookTop=((device.height()-twoPageBook.bookHeight)/2).toFixed(0);twoPageBook.bookLeft=((device.width()-twoPageBook.bookWidth)/2).toFixed(0);el.id("bookLandscape")?a=el.id("bookLandscape"):(a=el.add("div"),a.id="bookLandscape",a.style.webkitPerspective="3000",a.style.position="absolute",a.style.width=twoPageBook.bookWidth+"px",a.style.height=twoPageBook.bookHeight+
"px",a.style.top=twoPageBook.bookTop+"px",a.style.left=twoPageBook.bookLeft+"px",a.style.webkitBackfaceVisibility="hidden",a.style.zIndex="200",el.id("mainFrame").appendChild(a));twoPageBook.installed=!0;for(var b=1*twoPageBook.currentPage.left;b>twoPageBook.currentPage.left-2*twoPageBook.prevPageBuffer;b-=2)twoPageBook.drawPage(b,a,"left");for(b=1*twoPageBook.currentPage.right;b<1*twoPageBook.currentPage.right+2*twoPageBook.nextPageBuffer;b+=2)twoPageBook.drawPage(b,a,"right");pager.change();twoPageBook.shadow.draw();
delete a},drawPage:function(a,b,c){if("left"==c)var d=a-1+"x"+a,e=a-1,f="android"==device.name()?"rotateY(0deg)":"rotate3d(0, -1, 0, 0deg)",h=a;else"right"==c&&(d=a+"x"+(1*a+1),e=1*a+1,f="android"==device.name()?"rotateY(0deg)":"rotate3d(0, 1, 0, 0deg)",h=bookData.pageCount-a);if(!el.id(d)){if(0<a&&a<=bookData.pageCount){var g=el.add("div");g.id=d;g.style.position="absolute";g.style.cssFloat=c;if("right"==c)g.style.left=twoPageBook.bookWidth/2+"px";g.style.width=twoPageBook.bookWidth/2+"px";g.style.height=
twoPageBook.bookHeight+"px";g.style.webkitTransformStyle="preserve-3d";g.style.webkitTransition="-webkit-transform 1s";g.style.webkitTransform=f;g.style.zIndex=h+"";b.appendChild(g);twoPageBook.drawCanvasPage(a,g,"front")}0<e&&e<=bookData.pageCount&&twoPageBook.drawCanvasPage(e,g,"back");delete b}},drawCanvasPage:function(a,b,c){var d=el.add("canvas");d.id="canvas"+a;d.className="canvasBook";d.width=twoPageBook.bookWidth/2;d.height=twoPageBook.bookHeight;d.style.position="absolute";d.style.webkitBackfaceVisibility=
"hidden";d.style.webkitTransform="front"==c?"":"rotateY(180deg)";d.style.zIndex="front"==c?"1":"-1";c=d.getContext("2d");c.fillStyle="rgb(255,255,255)";c.fillRect(0,0,twoPageBook.bookWidth/2,twoPageBook.bookHeight);1==a||a==bookData.pageCount&&0==a%2||images.drawShadow(c,a);b.appendChild(d);bookData.page[a].stub||(images.push(a),preloader.add(a))},next:function(){if(zoomLock.check()&&twoPageBook.installed&&twoPageBook.currentPage.right<bookData.pageCount&&timer.check("fx")){twoPageBook.flipFxCurrentPage(twoPageBook.currentPage.right);
if(4==el.id("bookLandscape").childNodes.length){var a=1*twoPageBook.currentPage.left-(2*twoPageBook.nextPageBuffer-1),b=twoPageBook.currentPage.right-(2*twoPageBook.nextPageBuffer-1);images.deleteImageFromStack(a);images.deleteImageFromStack(b);el.del(a+"x"+b);delete bm.rasterize.imgData[a];preloader.deletePreloader(a);preloader.deletePreloader(b)}twoPageBook.currentPage.left+=2;twoPageBook.currentPage.right+=2;a=1*twoPageBook.currentPage.left+(twoPageBook.nextPageBuffer+1);el.id(a)||twoPageBook.drawPage(a,
el.id("bookLandscape"),"right");pageMediator.change();timer.setBlockTime(twoPageBook.flipSpeed/2,twoPageBook.flipSpeed)}},prev:function(){if(zoomLock.check()&&twoPageBook.installed&&0<twoPageBook.currentPage.left&&timer.check("fx")){twoPageBook.flipFxCurrentPage(twoPageBook.currentPage.left);if(4==el.id("bookLandscape").childNodes.length){var a=1*twoPageBook.currentPage.left+(2*twoPageBook.prevPageBuffer-1),b=1*twoPageBook.currentPage.right+(2*twoPageBook.prevPageBuffer-1);images.deleteImageFromStack(a);
images.deleteImageFromStack(b);el.del(1*twoPageBook.currentPage.left+(2*twoPageBook.prevPageBuffer-1)+"x"+(twoPageBook.currentPage.right+(2*twoPageBook.prevPageBuffer-1)));delete bm.rasterize.imgData[a];preloader.deletePreloader(a);preloader.deletePreloader(b)}twoPageBook.currentPage.left-=2;twoPageBook.currentPage.right-=2;a=1*twoPageBook.currentPage.left-twoPageBook.prevPageBuffer;el.id(a)||twoPageBook.drawPage(a,el.id("bookLandscape"),"left");pageMediator.change();timer.setBlockTime(twoPageBook.flipSpeed/
2,twoPageBook.flipSpeed)}},goToPage:function(a){if(0>a)a=1;else if(a>bookData.pageCount)a=bookData.pageCount;if(a==twoPageBook.currentPage.left||a==twoPageBook.currentPage.right)pageMediator.change();else if(a==1*twoPageBook.currentPage.right+1||a==1*twoPageBook.currentPage.right+2)twoPageBook.next();else if(a==1*twoPageBook.currentPage.left-1||a==1*twoPageBook.currentPage.left-2)twoPageBook.prev();else if(0<a&&a<=bookData.pageCount&&zoomLock.check()&&timer.check("fx")){bm.rasterize.imgData={};if(a>
twoPageBook.currentPage.right){if(a==bookData.pageCount&&0==a%2){for(var b=1,c=2*(twoPageBook.nextPageBuffer-1);b<c;b+=2){var d=1*twoPageBook.currentPage.right+1*b+1+"x"+(1*twoPageBook.currentPage.right+1*b+2);el.del(d);d=null}c=el.id("canvas"+(1*twoPageBook.currentPage.right+1));c=c.getContext("2d");c.fillStyle="rgb(255,255,255)";c.fillRect(0,0,twoPageBook.bookWidth/2,twoPageBook.bookHeight);c=null;preloader.add(1*twoPageBook.currentPage.right+1);preloader.setSpecial(1*twoPageBook.currentPage.right+
1)}else for(b=1;2>=b;b++)c=el.id("canvas"+(1*twoPageBook.currentPage.right+b)),c=c.getContext("2d"),c.fillStyle="rgb(255,255,255)",c.fillRect(0,0,twoPageBook.bookWidth/2,twoPageBook.bookHeight),images.drawShadow(c,1*twoPageBook.currentPage.right+b),c=null,preloader.add(1*twoPageBook.currentPage.right+b),preloader.setSpecial(1*twoPageBook.currentPage.right+b);twoPageBook.flipFxCurrentPage(twoPageBook.currentPage.right);twoPageBook.pageConverter(a);pageMediator.change()}else if(a<twoPageBook.currentPage.left){if(1==
a){b=1;for(c=2*(twoPageBook.prevPageBuffer-1);b<c;b+=2)d=1*twoPageBook.currentPage.left-(1*b+2)+"x"+(1*twoPageBook.currentPage.left-(1*b+1)),el.del(d),d=null;c=el.id("canvas"+(1*twoPageBook.currentPage.left-1));c=c.getContext("2d");c.fillStyle="rgb(255,255,255)";c.fillRect(0,0,twoPageBook.bookWidth/2,twoPageBook.bookHeight);preloader.add(1*twoPageBook.currentPage.left-1);preloader.setSpecial(1*twoPageBook.currentPage.left-1);c=c=null}else for(b=1;2>=b;b++)c=el.id("canvas"+(twoPageBook.currentPage.left-
b)),c=c.getContext("2d"),c.fillStyle="rgb(255,255,255)",c.fillRect(0,0,twoPageBook.bookWidth/2,twoPageBook.bookHeight),images.drawShadow(c,twoPageBook.currentPage.left-b),preloader.add(twoPageBook.currentPage.left-b),preloader.setSpecial(twoPageBook.currentPage.left-b),c=c=null;twoPageBook.flipFxCurrentPage(twoPageBook.currentPage.left);twoPageBook.pageConverter(a);pageMediator.change()}window.setTimeout(function(){preloader.stopAll();el.del("bookLandscape");twoPageBook.draw(a)},twoPageBook.flipSpeed+
100);timer.setBlockTime(twoPageBook.flipSpeed/2,twoPageBook.flipSpeed)}},flipFxCurrentPage:function(a){if(0!=a%2&&twoPageBook.installed&&twoPageBook.currentPage.right<bookData.pageCount){if("android"==device.name()){var b=el.id(this.currentPage.right+"x"+(1*this.currentPage.right+1));if("rotateY(0deg)"==b.style.webkitTransform)var c=a==bookData.pageCount-1?"rotateY(-179."+(1E4-a)+"deg)":"rotateY(-179."+(1E4-a)+"deg)",d="0% 0%";else c="rotateY(0deg)",d="100% 100%"}else b=el.id(this.currentPage.right+
"x"+(1*this.currentPage.right+1)),"rotate3d(0, 1, 0, 0deg)"==b.style.webkitTransform||"rotate3d(0, -1, 0, 0deg)"==b.style.webkitTransform?(c="rotate3d(0, -1, 0, 179."+(1E4-a)+"deg)",d="0% 0%"):(c="rotate3d(0, -1, 0, 0deg)",d="100% 100%");var e=1*twoPageBook.currentPage.right+1}else twoPageBook.installed&&0<twoPageBook.currentPage.left&&("android"==device.name()?(b=el.id(this.currentPage.left-1+"x"+this.currentPage.left),"rotateY(0deg)"==b.style.webkitTransform?(c=2==a||a==bookData.countPages?"rotateY(179."+
(1E4-(bookData.pageCount-a))+"deg)":"rotateY( 179."+(1E4-(bookData.pageCount-a))+"deg)",d="100% 100%"):(c="rotateY(0deg)",d="0% 0%")):(b=el.id(this.currentPage.left-1+"x"+this.currentPage.left),"rotate3d(0, -1, 0, 0deg)"==b.style.webkitTransform||"rotate3d(0, 1, 0, 0deg)"==b.style.webkitTransform?(c="rotate3d(0, 1, 0, 179."+(1E4-(bookData.pageCount-a))+"deg)",d="100% 100%"):(c="rotate3d(0, 1, 0, 0deg)",d="0% 0%")),e=bookData.pageCount-this.currentPage.left);b.style.webkitTransform=c+"";b.style.webkitTransformOrigin=
d+"";b.style.webkitTransitionTimingFunction="cubic-bezier(0, 0, 1, 0.95)";b.style.webkitTransitionDuration=this.flipSpeed+"ms";var f=function(){b.style.zIndex=e+"";for(var a=b.getElementsByTagName("*"),g=0;g<a.length;g++)a[g].style.zIndex="1"===a[g].style.zIndex?"-1":"1";delete b;e=c=d=b=null;delete f};window.setTimeout(f,twoPageBook.flipSpeed/2);a=null},destroy:function(){preloader.stopAll();el.del("bookLandscape");twoPageBook.installed=!1},goToZoom:function(a){if(zoomLock.check()){var b=a.target.id;
if(b=="canvas"+twoPageBook.currentPage.left)var c=twoPageBook.currentPage.left,d=0,e=twoPageBook.bookWidth/4;else if(b=="canvas"+twoPageBook.currentPage.right)c=twoPageBook.currentPage.right,d=twoPageBook.bookWidth/2,e=-(twoPageBook.bookWidth/4);var f=device.width()/(twoPageBook.bookWidth/2),h=a.target;h.style.left=d+"px";el.id("bookLandscape").appendChild(h);if("rotateY(180deg)"==h.style.webkitTransform)h.style.webkitTransform="rotateY(0deg)";h.style.zIndex="500";var g=function(){h.style.webkitTransitionDuration=
zoomBook.zoomIOSpeed+"ms";h.style.webkitTransform="android"==device.name()?"translate("+e+"px, 0px) scale("+f+","+f+")":"translate3d("+e+"px, 0px, 2px) scale3d("+f+","+f+",1)";delete g};window.setTimeout(g,1);var j=function(){el.id("canvas"+c).id="zoomedPage";zoomBook.draw(c,f,twoPageBook.bookWidth/2,twoPageBook.bookHeight);delete j};window.setTimeout(j,zoomBook.zoomIOSpeed+10)}},gestureStart:function(a){a=a.target;twoPageBook.gestureStore.element=a.id;twoPageBook.gestureStore.left=a.style.left;twoPageBook.gestureStore.zIndex=
a.style.zIndex;twoPageBook.gestureStore.webkit=a.style.webkitTransform;twoPageBook.gestureStore.parent=a.parentNode.id},gestureZoom:function(a){if(zoomLock.check()){var b=twoPageBook.gestureStore.element;if(b=="canvas"+twoPageBook.currentPage.left)var c=0;else b=="canvas"+twoPageBook.currentPage.right&&(c=twoPageBook.bookWidth/2);a=1+(a.scale-1)/3;b=el.id(twoPageBook.gestureStore.element);b.style.left=c+"px";b.style.zIndex=5E3;el.id("bookLandscape").appendChild(b);if("rotateY(180deg)"==b.style.webkitTransform)b.style.webkitTransform=
"rotateY(0deg)";b.style.webkitTransitionDuration="0ms";b.style.webkitTransform="scale3d("+a+","+a+",1) translate3d(0px, 0px, 2px)"}},gestureStop:function(a){if(zoomLock.check()){var b=twoPageBook.gestureStore.element;if(b=="canvas"+twoPageBook.currentPage.left)var c=twoPageBook.currentPage.left,d=twoPageBook.bookWidth/4;else if(b=="canvas"+twoPageBook.currentPage.right)c=twoPageBook.currentPage.right,d=-(twoPageBook.bookWidth/4);var e=1+(a.scale-1)/3,f=el.id(twoPageBook.gestureStore.element),h=Math.sqrt(5E6/
(twoPageBook.bookWidth*twoPageBook.bookHeight));e>h?(crossHTML5.transitionDuration(f,"200ms"),crossHTML5.transform(f,"translate3d("+d+"px, 0px,2px) scale3d("+h+","+h+","+h+")","translate("+d+"px, 0px)"),window.setTimeout(function(){el.id("canvas"+c).id="zoomedPage";zoomBook.draw(c,h,twoPageBook.bookWidth/2,twoPageBook.bookHeight)},200)):1.2>e?(crossHTML5.transitionDuration(f,"200ms"),crossHTML5.transform(f,"scale3d(1,1,1)",""),window.setTimeout(function(){f.style.left=twoPageBook.gestureStore.left;
f.style.zIndex=twoPageBook.gestureStore.zIndex;f.style.webkitTransform=twoPageBook.gestureStore.webkit;el.id(twoPageBook.gestureStore.parent).appendChild(f)},200)):(crossHTML5.transitionDuration(f,"200ms"),crossHTML5.transform(f,"translate3d("+d+"px, 0px,2px) scale3d("+e+","+e+","+e+")","translate("+d+"px, 0px)"),window.setTimeout(function(){el.id("canvas"+c).id="zoomedPage";zoomBook.draw(c,1*e,twoPageBook.bookWidth/2,twoPageBook.bookHeight)},200))}}};
twoPageBook.shadow={shadowSize:3,draw:function(){if(1==twoPageBook.currentPage.right){if(el.id("3x4"))el.id("3x4").style.webkitBoxShadow="0px 0px "+this.shadowSize+"px #000"}else if(twoPageBook.currentPage.left==bookData.pageCount){var a=bookData.pageCount-3+"x"+(bookData.pageCount-2);if(el.id(a))el.id(a).style.webkitBoxShadow="0px 0px "+this.shadowSize+"px #000"}else if(el.id("bookLandscape"))el.id("bookLandscape").style.webkitBoxShadow="0px 0px "+this.shadowSize+"px #000"},erase:function(){if(el.id("3x4"))el.id("3x4").style.webkitBoxShadow=
"0px 0px 0px #000";var a=bookData.pageCount-3+"x"+(bookData.pageCount-2);if(el.id(a))el.id(a).style.webkitBoxShadow="0px 0px 0px #000";if(el.id("bookLandscape"))el.id("bookLandscape").style.webkitBoxShadow="0px 0px 0px #000"},reDraw:function(){if(2==twoPageBook.currentPage.left||twoPageBook.currentPage.left==bookData.pageCount-2)window.setTimeout(function(){twoPageBook.shadow.erase();twoPageBook.shadow.draw()},twoPageBook.flipSpeed);else if(1==twoPageBook.currentPage.right||twoPageBook.currentPage.left==
bookData.pageCount)this.erase(),this.draw()}};
twoPageBook.events={tapCount:0,clickCount:0,doubleTapTime:250,doubleClickTime:250,leftAndRightArea:0.15,touchStart:function(a){"CANVAS"==a.target.tagName&&links.drawRect(a);delete a},touchMove:function(a){if(links.isLinkBool){var b=a.targetTouches[0].pageY-eventManager.touchStartCoordinate.y;(10<Math.abs(a.targetTouches[0].pageX-eventManager.touchStartCoordinate.x)||10<Math.abs(b))&&links.clearRect()}delete a},touchEnd:function(a){-50>eventManager.touchStartCoordinate.x-a.changedTouches[0].pageX?
twoPageBook.events.flipRight():50<eventManager.touchStartCoordinate.x-a.changedTouches[0].pageX?twoPageBook.events.flipLeft():twoPageBook.events.touchManger(a);delete a},gestureStart:function(a){this.gestureTarget=a.target;twoPageBook.gestureStart(a)},gestureChange:function(a){twoPageBook.gestureZoom(a)},gestureEnd:function(a){twoPageBook.gestureStop(a)},mousedown:function(a){"CANVAS"==a.target.tagName&&links.drawRect(a);delete a},mousemove:function(a){if(links.isLinkBool){var b=a.pageY-eventManager.clickStartCoordinate.y;
(10<Math.abs(a.pageX-eventManager.clickStartCoordinate.x)||10<Math.abs(b))&&links.clearRect()}delete a},mouseup:function(a){-50>eventManager.clickStartCoordinate.x-a.pageX?twoPageBook.events.flipRight():50<eventManager.clickStartCoordinate.x-a.pageX?twoPageBook.events.flipLeft():twoPageBook.events.clickManger(a);delete a},touchManger:function(a){if(links.isLinkBool&&links.currURLs){if(links.clearRect(),links.currURLs)for(var b=0;b<links.currURLs.length;b++)window.open(links.currURLs[b])}else if(twoPageBook.events.tapCount++,
1==twoPageBook.events.tapCount){var c=function(){if(1==twoPageBook.events.tapCount)twoPageBook.events.singleTap(a),twoPageBook.events.tapCount=0;delete c};window.setTimeout(c,twoPageBook.events.doubleTapTime)}else twoPageBook.events.doubleTap(a),twoPageBook.events.tapCount=0},clickManger:function(a){if(links.isLinkBool&&links.currURLs){if(links.clearRect(),links.currURLs)for(var b=0;b<links.currURLs.length;b++)window.open(links.currURLs[b])}else if(twoPageBook.events.clickCount++,1==twoPageBook.events.clickCount){var c=
function(){if(1==twoPageBook.events.clickCount)twoPageBook.events.singleClick(a),twoPageBook.events.clickCount=0;delete c};window.setTimeout(c,twoPageBook.events.doubleClickTime)}else twoPageBook.events.doubleClick(a),twoPageBook.events.clickCount=0},singleTap:function(a){links.isLinkBool?(links.clearRect(),links.currGoPage&&twoPageBook.goToPage(links.currGoPage)):a.changedTouches[0].pageX<device.width()*twoPageBook.events.leftAndRightArea?twoPageBook.prev():a.changedTouches[0].pageX>device.width()-
device.width()*twoPageBook.events.leftAndRightArea?twoPageBook.next():toolbar.toogle();delete a},doubleTap:function(a){links.isLinkBool&&links.clearRect();"CANVAS"==a.target.tagName&&twoPageBook.goToZoom(a)},singleClick:function(a){links.isLinkBool?(links.clearRect(),links.currGoPage&&twoPageBook.goToPage(links.currGoPage)):(a.x<device.width()*twoPageBook.events.leftAndRightArea?twoPageBook.prev():a.x>device.width()-device.width()*twoPageBook.events.leftAndRightArea?twoPageBook.next():toolbar.toogle(),
delete a,a=null);delete a},doubleClick:function(a){links.isLinkBool&&links.clearRect();"CANVAS"==a.target.tagName&&twoPageBook.goToZoom(a)},flipLeft:function(){twoPageBook.next()},flipRight:function(){twoPageBook.prev()}};
var workspace={draw:function(){var a=device.width()+"px",b=device.height()+"px";el.id("mainFrame").style.width=a;el.id("mainFrame").style.height=b;el.id("body").style.width=a;el.id("body").style.height=b},reDraw:function(){workspace.draw()}},zoomBook={currentPage:0,installed:!1,verticalScroll:!1,horizontalScroll:!1,noFreeze:!1,pageAreaWidth:0,pageAreaHeight:0,pageWidth:0,pageHeight:0,topShift:0,leftShift:0,innerShift:10,translateScrollX:0,translateScrollY:0,zoomFactor:0,currentPage:0,nextPageBuffer:1,
prevPageBuffer:1,slideSpeed:800,zoomIOSpeed:800,sourcePageHeight:0,sourcePageWidth:0,innerZoomState:!1,initSizes:function(a,b,c,d){this.zoomFactor=a;this.currentPage=d;this.pageWidth=b.toFixed(0);this.pageHeight=c.toFixed(0);this.pageAreaWidth=b>device.width()?b+this.innerShift:device.width()+this.innerShift;this.pageAreaHeight=c>device.height()?c:device.height();this.pageAreaWidth=this.pageAreaWidth;this.translateScrollY=((this.pageAreaHeight-device.height())/2).toFixed(0);this.translateScrollX=
((this.pageAreaWidth-device.width())/2).toFixed(0);this.topShift=((device.height()-c)/2).toFixed(0);this.leftShift=((device.width()-b)/2).toFixed(0);b.toFixed(0)>=device.width()?(this.horizontalScroll=!0,this.leftShift=0):(this.horizontalScroll=!1,this.translateScrollX=0);c.toFixed(0)>device.height()?(this.verticalScroll=!0,this.topShift=0):(this.verticalScroll=!1,this.translateScrollY=0);this.translateX=this.pageAreaWidth*(this.currentPage-1)+1*this.translateScrollX},draw:function(a,b,c,d,e,f){preloader.stopAll();
zoomBook.noFreeze?zoomBook.noFreeze=!1:zoomLock.lock();b=b||this.zoomFactor;bookData.size.proportions<device.proportions()?(onePageBook.bookHeight=(device.height()-onePageBook.padding).toFixed(0),onePageBook.bookWidth=(onePageBook.bookHeight*bookData.size.proportions).toFixed(0)):(onePageBook.bookWidth=device.width()-onePageBook.padding,onePageBook.bookHeight=(onePageBook.bookWidth/bookData.size.proportions).toFixed(0));this.sourcePageWidth=c||onePageBook.bookWidth;this.sourcePageHeight=d||onePageBook.bookHeight;
pageWidth=this.sourcePageWidth*b;pageHeight=this.sourcePageHeight*b;this.initSizes(b,pageWidth,pageHeight,a);if(void 0!=e&&void 0!=f)this.translateScrollY=f,this.translateScrollX=e+this.innerShift/2;if(!el.id("zoomBook"))b=el.add("div"),b.id="zoomBook",crossHTML5.perspective(b,"3000"),b.style.position="absolute",b.style.width=this.pageAreaWidth+"px",b.style.height=this.pageAreaHeight+"px",b.style.zIndex=10,crossHTML5.backfaceVisibility(b,"hidden"),crossHTML5.transform(b,"translate3d("+-(1*this.translateScrollX-
this.innerShift/2)+"px,"+-this.translateScrollY+"px,0px)","translate("+-(1*this.translateScrollX)+"px,"+-this.translateScrollY+"px)"),el.id("mainFrame").appendChild(b);zoomBook.installed=!0;pager.change();zoomBook.drawPage(this.currentPage);for(b=a-zoomBook.prevPageBuffer;b<=1*a+zoomBook.nextPageBuffer;b++)b!=this.currentPage&&zoomBook.drawPage(b);buttons.slideShow.check()},drawPage:function(a){if(onePageBook.installed&&a==onePageBook.currentPage){var b=el.add("div");b.id="tmpDiv";b.className="canvasZoom";
b.style.width=zoomBook.pageWidth+"px";b.style.height=zoomBook.pageHeight+"px";b.style.left=zoomBook.leftShift+"px";b.style.position="absolute";b.style.zIndex="100";crossHTML5.backfaceVisibility(b,"hidden");var c=(a-zoomBook.currentPage)*zoomBook.pageAreaWidth;crossHTML5.transform(b,"translate3d("+c+"px, 0px, 0px)","translate("+c+"px, 0px)");el.id("zoomBook").appendChild(b);b.appendChild(el.id("zoomedPage"));el.del("bookPortrait");el.id("zoomedPage").style.left=1*onePageBook.bookLeft+1*this.translateScrollX-
zoomBook.innerShift/2+"px";el.id("zoomedPage").style.top=1*onePageBook.bookTop+1*this.translateScrollY+"px";preloader.insertSimpleLoader(el.id("mainFrame"),device.width()/2-20,device.height()/2-20)}if(twoPageBook.installed&&a==zoomBook.currentPage)b=el.add("div"),b.id="tmpDiv",b.className="canvasZoom",b.style.width=zoomBook.pageWidth+"px",b.style.height=zoomBook.pageHeight+"px",b.style.left=zoomBook.leftShift+"px",b.style.position="absolute",b.style.zIndex="100",crossHTML5.backfaceVisibility(b,"hidden"),
c=(a-zoomBook.currentPage)*zoomBook.pageAreaWidth,crossHTML5.transform(b,"translate3d("+c+"px, 0px, 2px)","translate("+c+"px, 0px)"),el.id("zoomBook").appendChild(b),b.appendChild(el.id("zoomedPage")),el.del("bookLandscape"),c=twoPageBook.bookWidth/2*zoomBook.zoomFactor<device.width()?(device.width()-twoPageBook.bookWidth/2*zoomBook.zoomFactor)/2:0,0==a%2?el.id("zoomedPage").style.left=1*twoPageBook.bookLeft-1*c+1*this.translateScrollX-zoomBook.innerShift/2+"px":el.id("zoomedPage").style.left=1*twoPageBook.bookLeft+
twoPageBook.bookWidth/2-1*c+1*this.translateScrollX-zoomBook.innerShift/2+"px",el.id("zoomedPage").style.top=1*twoPageBook.bookTop+1*this.translateScrollY+"px",preloader.insertSimpleLoader(el.id("mainFrame"),device.width()/2-20,device.height()/2-20);if(0<a&&a<=bookData.pageCount)b=el.add("canvas"),b.id="canvas"+a,b.className="canvasZoom",b.width=zoomBook.pageWidth,b.height=zoomBook.pageHeight,b.style.left=zoomBook.leftShift+"px",b.style.top=zoomBook.topShift+"px",b.style.position="absolute",crossHTML5.backfaceVisibility(b,
"hidden"),c=(a-zoomBook.currentPage)*zoomBook.pageAreaWidth,crossHTML5.transform(b,"translate3d("+c+"px, 0px, 0px)","translate("+c+"px, 0px)"),crossHTML5.boxShadow(b,"0px 0px 3px #000"),c=b.getContext("2d"),c.fillStyle="rgb(255,255,255)",c.fillRect(0,0,zoomBook.pageWidth,zoomBook.pageHeight),el.id("zoomBook").appendChild(b),bookData.page[a].stub||images.push(a)},moveFX:function(a){for(var b=1*zoomBook.currentPage-zoomBook.prevPageBuffer;b<=1*zoomBook.currentPage+zoomBook.nextPageBuffer;b++)if(0<b&&
b<=bookData.pageCount){if(el.id("tmpDiv")&&b==zoomBook.currentPage){var c=el.id("tmpDiv"),d=(zoomBook.currentPage-zoomBook.currentPage-1*a)*zoomBook.pageAreaWidth;crossHTML5.transitionDuration(c,zoomBook.slideSpeed+"ms");crossHTML5.transform(c,"translate3d("+d+"px, 0px, 0px)","translate("+d+"px, 0px)");window.setTimeout(function(){el.del("tmpDiv")},zoomBook.slideSpeed+10);c=d=null}el.id("canvas"+b)&&(c=el.id("canvas"+b),d=(b-zoomBook.currentPage-1*a)*zoomBook.pageAreaWidth,crossHTML5.transitionDuration(c,
zoomBook.slideSpeed+"ms"),crossHTML5.transform(c,"translate3d("+d+"px, 0px, 0px)","translate("+d+"px, 0px)"),c=d=null);this.adjustmentFX()}},adjustmentFX:function(){this.translateScrollX=this.translateScrollY=0;var a=el.id("zoomBook");crossHTML5.transitionDuration(a,zoomBook.slideSpeed+"ms");crossHTML5.transform(a,"translate3d("+-this.translateScrollX+"px,"+-this.translateScrollY+"px,0px)","translate("+-this.translateScrollX+"px,"+-this.translateScrollY+"px)")},next:function(){if(zoomLock.check()&&
zoomBook.currentPage<bookData.pageCount&&timer.check("fx")){zoomBook.moveFX(1);zoomBook.currentPage++;pager.change();var a=function(){var b=zoomBook.currentPage-zoomBook.prevPageBuffer-1;el.id("canvas"+b)&&el.del("canvas"+b);images.deleteImageFromStack(b);preloader.deletePreloader(b);delete a;zoomBook.drawPage(1*zoomBook.currentPage+zoomBook.nextPageBuffer)};window.setTimeout(a,zoomBook.slideSpeed);timer.setBlockTime(zoomBook.slideSpeed/2,zoomBook.slideSpeed)}},prev:function(){if(zoomLock.check()&&
1<zoomBook.currentPage&&timer.check("fx")){zoomBook.moveFX(-1);zoomBook.currentPage--;pager.change();var a=function(){var b=1*zoomBook.currentPage+1*zoomBook.nextPageBuffer+1;el.id("canvas"+b)&&el.del("canvas"+b);images.deleteImageFromStack(b);preloader.deletePreloader(b);delete a;zoomBook.drawPage(1*zoomBook.currentPage-zoomBook.prevPageBuffer)};window.setTimeout(a,zoomBook.slideSpeed);timer.setBlockTime(zoomBook.slideSpeed/2,zoomBook.slideSpeed)}},destroy:function(){preloader.stopAll();el.del("zoomBook")},
goToPage:function(a){if(0>a)a=1;else if(a>bookData.pageCount)a=bookData.pageCount;if(a==zoomBook.currentPage)pageMediator.change();else if(a==1*zoomBook.currentPage+1)zoomBook.next();else if(a==1*zoomBook.currentPage-1)zoomBook.prev();else if(0<a&&a<=bookData.pageCount&&zoomLock.check()&&timer.check("fx")){zoomBook.noFreeze=!0;if(1*a>1*zoomBook.currentPage){var b=1*zoomBook.currentPage+1,c=el.id("canvas"+b).getContext("2d"),b=null;c.fillStyle="rgb(255,255,255)";c.fillRect(0,0,zoomBook.pageWidth,zoomBook.pageHeight);
preloader.add(1*zoomBook.currentPage+1);preloader.setSpecial(1*zoomBook.currentPage+1);zoomBook.moveFX(1)}else b=1*zoomBook.currentPage-1,c=el.id("canvas"+b).getContext("2d"),b=null,c.fillStyle="rgb(255,255,255)",c.fillRect(0,0,zoomBook.pageWidth,zoomBook.pageHeight),preloader.add(1*zoomBook.currentPage-1),preloader.setSpecial(1*zoomBook.currentPage-1),zoomBook.moveFX(-1);zoomBook.currentPage=a;pager.change();var d=function(){zoomBook.destroy();zoomBook.draw(a,zoomBook.zoomFactor,zoomBook.sourcePageWidth,
zoomBook.sourcePageHeight);zoomBook.adjustmentFX();delete d},c=null;window.setTimeout(d,zoomBook.slideSpeed)}},scroll:function(a,b){if(zoomLock.check()){if(this.horizontalScroll)if(this.translateScrollX-a>this.pageWidth-device.width())var c=this.pageWidth-device.width()-this.translateScrollX,a=-(c-(a+c)/2);else 0>this.translateScrollX-a&&(a=1*this.translateScrollX-(1*this.translateScrollX-a)/3);else a=0;this.verticalScroll?this.translateScrollY-b>this.pageHeight-device.height()?(c=this.pageHeight-
device.height()-this.translateScrollY,b=-(c-(b+c)/2)):0>this.translateScrollY-b&&(b=1*this.translateScrollY-(1*this.translateScrollY-b)/3):b=0;c=el.id("zoomBook");crossHTML5.transitionDuration(c,"0ms");crossHTML5.transform(c,"translate3d("+(1*-this.translateScrollX+1*a)+"px,"+(1*-this.translateScrollY+1*b)+"px,0px)","translate("+(1*-this.translateScrollX+1*a)+"px,"+(1*-this.translateScrollY+1*b)+"px)")}},scrollEnd:function(a,b){if(zoomLock.check()){var c=this.horizontalScroll?"iPad"==device.name()?
-300:-125:"iPad"==device.name()?-130:-50;if(this.translateScrollX-a>this.pageWidth-device.width()&&a<c&&this.currentPage!=bookData.pageCount)this.next();else if(0>this.translateScrollX-a&&1!=this.currentPage&&1*this.translateScrollX-a<c)this.prev();else{if(this.verticalScroll)this.translateScrollY=this.translateScrollY-b>this.pageHeight-device.height()?this.pageHeight-device.height():0>this.translateScrollY-b?0:this.translateScrollY-b;if(this.horizontalScroll)this.translateScrollX=this.translateScrollX-
a>this.pageWidth-device.width()?this.pageWidth-device.width():0>this.translateScrollX-a?0:this.translateScrollX-a;c=el.id("zoomBook");crossHTML5.transitionDuration(c,"300ms");crossHTML5.transform(c,"translate3d("+-this.translateScrollX+"px,"+-this.translateScrollY+"px,0px)","translate("+-this.translateScrollX+"px,"+-this.translateScrollY+"px)")}maxDeltaX=null}},zoomOutOnePage:function(a,b){bookData.size.proportions<device.proportions()?(onePageBook.bookHeight=(device.height()-onePageBook.padding).toFixed(0),
onePageBook.bookWidth=(onePageBook.bookHeight*bookData.size.proportions).toFixed(0)):(onePageBook.bookWidth=device.width()-onePageBook.padding,onePageBook.bookHeight=(onePageBook.bookWidth/bookData.size.proportions).toFixed(0));var c=onePageBook.bookWidth/zoomBook.pageWidth,d=zoomBook.verticalScroll?(zoomBook.pageHeight-device.height())/2:0,e=zoomBook.horizontalScroll?(zoomBook.pageWidth-device.width())/2:0;zoomEl=el.id("canvas"+zoomBook.currentPage);crossHTML5.transitionDuration(el.id("zoomBook"),
zoomBook.zoomIOSpeed+"ms");"standart"===b&&crossHTML5.transform(el.id("zoomBook"),"translate3d("+-e+"px,"+-d+"px,0px)","translate("+-e+"px,"+-d+"px)");crossHTML5.transitionDuration(zoomEl,zoomBook.zoomIOSpeed+"ms");"standart"===b&&crossHTML5.transform(zoomEl,"scale3d("+c+","+c+",1)","scale("+c+")");var f=function(){zoomBook.destroyOtherPages();el.id("zoomBook").id="exZoomBook";el.id("exZoomBook").style.zIndex=1E4;el.id("canvas"+zoomBook.currentPage).id="sd";preloader.insertSimpleLoader(el.id("mainFrame"),
device.width()/2-20,device.height()/2-20);zoomBook.innerZoomState=!0;zoomBook.installed=!1;buttons.slideShow.check();onePageBook.draw(zoomBook.currentPage);delete f},d=e=c=null;window.setTimeout(f,zoomBook.zoomIOSpeed+50)},zoomOutTwoPage:function(a,b){2*bookData.size.proportions<device.proportions()?(twoPageBook.bookWidth=((device.height()-twoPageBook.padding)*2*bookData.size.proportions).toFixed(0),twoPageBook.bookHeight=(device.height()-twoPageBook.padding).toFixed(0)):(twoPageBook.bookWidth=device.width()-
twoPageBook.padding,twoPageBook.bookHeight=((device.width()-twoPageBook.padding)/(2*bookData.size.proportions)).toFixed(0));var c=twoPageBook.bookWidth/2/zoomBook.pageWidth,d=zoomBook.verticalScroll?(zoomBook.pageHeight-device.height())/2:0,e=zoomBook.horizontalScroll?(zoomBook.pageWidth-device.width())/2:0,e=0==zoomBook.currentPage%2?e+twoPageBook.bookWidth/4:e-twoPageBook.bookWidth/4;zoomEl=el.id("canvas"+zoomBook.currentPage);zoomBook.destroyOtherPages();crossHTML5.transitionDuration(el.id("zoomBook"),
zoomBook.zoomIOSpeed+"ms");"standart"===b?crossHTML5.transform(el.id("zoomBook"),"translate3d("+-e+"px,"+-d+"px,0px)","translate("+-e+"px,"+-d+"px)"):crossHTML5.transform(el.id("zoomBook"),"translate3d("+-e+"px,"+-zoomBook.translateScrollY+"px,0px)","translate("+-e+"px,"+-d+"px)");crossHTML5.transitionDuration(zoomEl,zoomBook.zoomIOSpeed+"ms");"standart"===b&&crossHTML5.transform(zoomEl,"scale3d("+c+","+c+",1)","scale("+c+")");el.id("zoomBook").style.zIndex=1E4;var f=function(){el.id("zoomBook").id=
"exZoomBook";el.id("canvas"+zoomBook.currentPage).id="sd";zoomBook.innerZoomState=!0;zoomBook.installed=!1;buttons.slideShow.check();twoPageBook.draw(zoomBook.currentPage);var a=2*bookData.size.proportions<device.proportions()?((device.height()-twoPageBook.padding)*2*bookData.size.proportions).toFixed(0):device.width()-twoPageBook.padding;0!=zoomBook.currentPage%2&&(a=-a);preloader.insertSimpleLoader(el.id("mainFrame"),device.width()/2-a/4-20,device.height()/2-20);delete f};window.setTimeout(f,zoomBook.zoomIOSpeed+
50);d=e=c=null},zoomOut:function(a,b){zoomLock.check()&&(zoomLock.lock(),b=b||"standart",preloader.stopAll(),"one"===bookChoice.getType()?zoomBook.zoomOutOnePage(a,b):zoomBook.zoomOutTwoPage(a,b))},destroyOtherPages:function(){for(var a=1*zoomBook.currentPage+1*zoomBook.nextPageBuffer,b=zoomBook.currentPage-zoomBook.prevPageBuffer;b<=a;b++)b!=zoomBook.currentPage&&0<b&&b<=bookData.pageCount&&el.del("canvas"+b)},gestureStart:function(){if(zoomLock.check()){this.xScale=(device.width()/2+1*zoomBook.translateScrollX-
this.innerShift/2).toFixed(0);this.yScale=(device.height()/2+1*zoomBook.translateScrollY).toFixed(0);if(device.width()>this.pageWidth)this.xScale=(this.pageWidth/2).toFixed(0);if(device.height()>this.pageHeight)this.yScale=(this.pageHeight/2).toFixed(0)}},gestureZoom:function(a){if(zoomLock.check()){var b=el.id("canvas"+zoomBook.currentPage),a=(1+(a.scale-1)/2).toFixed(2);crossHTML5.transitionDuration(b,"0ms");b.style.webkitTransformOrigin=this.xScale+"px "+this.yScale+"px";crossHTML5.transform(b,
"scale3d("+a+","+a+",1)","scale("+a+")")}},gestureStop:function(a){if(zoomLock.check()){var b="one"===bookChoice.getType()?1.15:1.55,c=Math.sqrt(5E6/(this.pageWidth*this.pageHeight));if("two"===bookChoice.getType())if(bookData.size.proportions*bookData.size.proportions<device.proportions())var d=(device.height()-twoPageBook.padding).toFixed(0),d=d/this.pageHeight;else d=(device.width()-(twoPageBook.bookWidth/2+twoPageBook.padding)).toFixed(0),d/=this.pageWidth;else bookData.size.proportions<device.proportions()?
(d=(device.height()-onePageBook.padding).toFixed(0),d/=this.pageHeight):(d=(device.width()-onePageBook.padding).toFixed(0),d/=this.pageWidth);var e=el.id("canvas"+zoomBook.currentPage),f=this.xScale,h=this.yScale,g=(1+(a.scale-1)/2).toFixed(2);g>c?g=c:g/d<b&&(g=d);if(this.pageWidth*g<device.width())var a=f*g-device.width()/2+(device.width()-this.pageWidth*g)/2,j=0;else this.pageWidth*g>=device.width()&&0>f*g-device.width()/2?(a=f*g-device.width()/2,j=0):this.pageWidth*g>=device.width()&&0<device.width()-
(this.pageWidth*g-(f*g-device.width()/2))?(a=device.width()-(this.pageWidth*g-(f*g-device.width()/2)),j=f*g-device.width()/2-a):(a=0,j=f*g-device.width()/2);if(this.pageHeight*g<device.height())var c=h*g-device.height()/2+(device.height()-this.pageHeight*g)/2,k=0;else this.pageHeight*g>=device.height()&&0>h*g-device.height()/2?(c=h*g-device.height()/2,k=0):this.pageHeight*g>=device.height()&&0<device.height()-(this.pageHeight*g-(h*g-device.height()/2))?(c=device.height()-(this.pageHeight*g-(h*g-device.height()/
2)),k=h*g-device.height()/2-c):(c=0,k=h*g-device.height()/2);0!=c&&0!=a&&(a+=5);crossHTML5.transitionDuration(e,"150ms");crossHTML5.transform(e,"translate3d("+1*a+"px, "+c+"px, 0px) scale3d("+g+","+g+",1)","scale(1)");var l=function(){zoomBook.destroyOtherPages();el.id("zoomBook").id="exZoomBook";el.id("exZoomBook").style.zIndex=1E4;preloader.insertSimpleLoader(el.id("mainFrame"),device.width()/2-20,device.height()/2-20);el.id("canvas"+zoomBook.currentPage).id="sd";zoomBook.innerZoomState=!0;zoomBook.draw(zoomBook.currentPage,
g,zoomBook.pageWidth,zoomBook.pageHeight,j,k);delete l};(g*this.pageWidth).toFixed(0)!=this.pageWidth?g/d<b?zoomBook.zoomOutFinger():window.setTimeout(l,200):g===d&&zoomBook.zoomOutFinger()}},zoomOutFinger:function(){window.setTimeout(function(){zoomBook.zoomOut(event,"inner")},200)}};
zoomBook.events={tapCount:0,clickCount:0,doubleTapTime:250,doubleClickTime:250,leftAndRightArea:0.15,gestureTarget:0,gestureStart:function(a){this.gestureTarget=a.target;zoomBook.gestureStart(a)},gestureChange:function(a){zoomBook.gestureZoom(a)},gestureEnd:function(a){zoomBook.gestureStop(a)},touchStart:function(a){"CANVAS"==a.target.tagName&&links.drawRect(a);delete a},touchMove:function(a){var b=a.targetTouches[0].pageX-eventManager.touchStartCoordinate.x,c=a.targetTouches[0].pageY-eventManager.touchStartCoordinate.y;
links.isLinkBool&&(2<Math.abs(b)||2<Math.abs(c))&&links.clearRect();zoomBook.scroll(b,c);delete a},touchEnd:function(a){2<Math.abs(eventManager.touchStartCoordinate.x-a.changedTouches[0].pageX)||2<Math.abs(eventManager.touchStartCoordinate.y-a.changedTouches[0].pageY)?zoomBook.scrollEnd(a.changedTouches[0].pageX-eventManager.touchStartCoordinate.x,a.changedTouches[0].pageY-eventManager.touchStartCoordinate.y):zoomBook.events.touchManger(a)},mousedown:function(a){"CANVAS"==a.target.tagName&&links.drawRect(a);
delete a},mousemove:function(a){var b=a.pageX-eventManager.clickStartCoordinate.x,c=a.pageY-eventManager.clickStartCoordinate.y;links.isLinkBool&&(2<Math.abs(b)||2<Math.abs(c))&&links.clearRect();zoomBook.scroll(b,c);delete a},mouseup:function(a){2<Math.abs(eventManager.clickStartCoordinate.x-a.pageX)||2<Math.abs(eventManager.clickStartCoordinate.y-a.pageY)?zoomBook.scrollEnd(a.pageX-eventManager.clickStartCoordinate.x,a.pageY-eventManager.clickStartCoordinate.y):zoomBook.events.clickManger(a)},touchManger:function(a){if(links.isLinkBool&&
links.currURLs){if(links.clearRect(),links.currURLs){for(var b=0;b<links.currURLs.length;b++)window.open(links.currURLs[b]);b=null}}else if(zoomBook.events.tapCount++,1==zoomBook.events.tapCount){var c=function(){if(1==zoomBook.events.tapCount)zoomBook.events.singleTap(a),zoomBook.events.tapCount=0;delete c};window.setTimeout(c,zoomBook.events.doubleTapTime)}else zoomBook.events.doubleTap(a),zoomBook.events.tapCount=0},clickManger:function(a){if(links.isLinkBool&&links.currURLs){if(links.clearRect(),
links.currURLs)for(var b=0;b<links.currURLs.length;b++)window.open(links.currURLs[b])}else if(zoomBook.events.clickCount++,1==zoomBook.events.clickCount){var c=function(){if(1==zoomBook.events.clickCount)zoomBook.events.singleClick(a),zoomBook.events.clickCount=0;delete c};window.setTimeout(c,zoomBook.events.doubleClickTime)}else zoomBook.events.doubleClick(a),zoomBook.events.clickCount=0},singleTap:function(a){links.isLinkBool?(links.clearRect(),links.currGoPage&&zoomBook.goToPage(links.currGoPage)):
a.changedTouches[0].pageX<device.width()*zoomBook.events.leftAndRightArea?zoomBook.prev():a.changedTouches[0].pageX>device.width()-device.width()*zoomBook.events.leftAndRightArea?zoomBook.next():toolbar.toogle();delete a},doubleTap:function(){links.isLinkBool&&links.clearRect();zoomBook.zoomOut()},singleClick:function(a){if(links.isLinkBool)links.clearRect(),links.currGoPage&&zoomBook.goToPage(links.currGoPage);else{var b=browser.publisher.isOn?device.width()/2:device.width();a.x<b*twoPageBook.events.leftAndRightArea?
zoomBook.prev():a.x>b-b*twoPageBook.events.leftAndRightArea?zoomBook.next():toolbar.toogle()}delete a},doubleClick:function(a){links.isLinkBool&&links.clearRect();zoomBook.zoomOut(a)},flipLeft:function(){zoomBook.next()},flipRight:function(){zoomBook.prev()}};var zoomLock={status:!0,lock:function(){this.status=!1},unLock:function(){this.status=!0},check:function(){return zoomLock.status}};